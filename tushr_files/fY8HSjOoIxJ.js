if (self.CavalryLogger) { CavalryLogger.start_js(["dF7Ic"]); }

__d('BloodDonorSettings',['DOM','DOMScroll','URI','Event'],(function a(b,c,d,e,f,g){var h={scrollToSetting:function i(j){if(c('URI').getRequestURI().getQueryData().focus_blood_donor_settings)c('Event').listen(window,'load',function(){this._scrollAndFocus(j);}.bind(this));},_scrollAndFocus:function i(j){c('DOMScroll').scrollTo(j,500,false,false,0,function(){c('DOM').find(j,'blood_type').focus();});}};f.exports=h;}),null);
__d('AggregatedMapCalloutOrientation',[],(function a(b,c,d,e,f,g){var h={};Object.assign(h,{TOP:'fbMapCalloutUseArrowTop',LEFT:'fbMapCalloutUseArrowLeft',RIGHT:'fbMapCalloutUseArrowRight',BOTTOM:'fbMapCalloutUseArrowBottom',ALWAYS_ON_MAP:'alwaysOnMap'});f.exports=h;}),null);
__d('AggregatedMapCallout',['AggregatedMapCalloutOrientation','CSS','DOM','Style','Vector'],(function a(b,c,d,e,f,g){var h=16,i=10,j=10;function k(l,m,n){this.map=l;this.contentContainer=null;this.width=null;this.height=null;this.anchor=null;this.orientation=c('AggregatedMapCalloutOrientation').RIGHT;this.arrowYOffset=null;this.arrowXOffset=null;this.border=m;this.contentContainer=c('DOM').find(this.border,'.fbMapCalloutContent');this.arrowWrap=c('DOM').find(this.border,'.fbMapCalloutArrowWrap');this.arrowL=c('DOM').find(this.border,'.fbMapCalloutArrowLeft');this.arrowR=c('DOM').find(this.border,'.fbMapCalloutArrowRight');this.arrowT=c('DOM').find(this.border,'.fbMapCalloutArrowTop');this.arrowB=c('DOM').find(this.border,'.fbMapCalloutArrowBottom');this._updateDimensions();}Object.assign(k.prototype,{setOrientation:function l(m){this.orientation=m;},getOrientation:function l(){return this.orientation;},getRoot:function l(){return this.border;},getAnchor:function l(){return this.anchor;},close:function l(){this.anchor=null;this._map_updatePosition();},updateAnchor:function l(m){this.anchor=m;this._map_updatePosition();},setContent:function l(m){c('DOM').setContent(this.contentContainer,m);this._updateDimensions();},getContent:function l(){return this.contentContainer;},recalculateArrowYOffset:function l(m){if(!this.anchor)return;var n=this.map._callout_determineArrowYOffset(this,m,this.width,this.height);this.setArrowYOffset(n);this._map_updatePosition();},_updateDimensions:function l(){c('CSS').show(this.border);this.width=c('Vector').getElementDimensions(this.border).x;this.height=c('Vector').getElementDimensions(this.border).y;this.setArrowXOffset(this.width/2);this.setArrowYOffset(this.height/2);c('CSS').hide(this.border);},_map_moveTo:function l(m,n){this.anchor=m;this.map._callout_panTo(m,this,n);this._map_updatePosition();},_map_updatePosition:function l(){var m=this.anchor&&this.map._callout_getAnchorBounds(this.anchor);if(m===null){c('CSS').hide(this.border);return;}var n,o,p,q,r=i,s=this.orientation;if(this.orientation===c('AggregatedMapCalloutOrientation').ALWAYS_ON_MAP){var t=m.getCenter().x,u=m.getCenter().y;if(t<0&&u<0){o=j;n=j;}else if(t>this.map.ww&&u<0){p=j;n=j;}else if(t>this.map.ww&&u>this.map.hh){p=j;q=j;}else if(t<0&&u>this.map.hh){o=j;q=j;}else if(t<0){s=c('AggregatedMapCalloutOrientation').RIGHT;o=j;n=m.calloutY-this.arrowYOffset;}else if(t>this.map.ww){s=c('AggregatedMapCalloutOrientation').LEFT;p=j;n=m.calloutY-this.arrowYOffset;}else if(u<0){s=c('AggregatedMapCalloutOrientation').BOTTOM;n=j;o=(m.l+m.r)/2-this.arrowXOffset;}else if(u>this.map.hh){s=c('AggregatedMapCalloutOrientation').TOP;q=j;o=(m.l+m.r)/2-this.arrowXOffset;}else{n=m.calloutY-this.arrowYOffset;if(t<this.map.ww/2){o=m.r+r;s=c('AggregatedMapCalloutOrientation').RIGHT;}else{o=m.l-r-this.width;s=c('AggregatedMapCalloutOrientation').LEFT;}}}switch(this.orientation){case c('AggregatedMapCalloutOrientation').LEFT:o=m.l-r-this.width;n=m.calloutY-this.arrowYOffset;break;case c('AggregatedMapCalloutOrientation').RIGHT:o=m.r+r;n=m.calloutY-this.arrowYOffset;break;case c('AggregatedMapCalloutOrientation').TOP:q=this.map._getH()-m.t+r;o=(m.l+m.r)/2-this.arrowXOffset;break;case c('AggregatedMapCalloutOrientation').BOTTOM:n=m.b+r;o=(m.l+m.r)/2-this.arrowXOffset;break;}c('CSS').setClass(this.arrowWrap,s);this._setPosition('top',n);this._setPosition('right',p);this._setPosition('bottom',q);this._setPosition('left',o);c('CSS').show(this.border);},_setPosition:function l(m,n){if(n!==undefined){n+='px';}else n='auto';c('Style').set(this.border,m,n);},setArrowXOffset:function l(m){this.arrowXOffset=m;m-=Math.round(h/2);c('Style').set(this.arrowT,'left',m+'px');c('Style').set(this.arrowB,'left',m+'px');},setArrowYOffset:function l(m){this.arrowYOffset=m;m-=Math.round(h/2);c('Style').set(this.arrowL,'top',m+'px');c('Style').set(this.arrowR,'top',m+'px');}});Object.assign(k,{throbber:function l(m){m=m||this.DEFAULT_CALLOUT_WIDTH;var n=c('DOM').create('div',{}),o=c('DOM').create('img',{src:'/images/loaders/indicator_blue_small.gif'});c('CSS').setClass(n,'fbAggregatedMapCalloutThrobberDiv');c('Style').set(n,'width',m+'px');c('CSS').setClass(o,'fbAggregatedMapCalloutThrobber');c('DOM').setContent(n,o);return n;},ARROW_HEIGHT_PLUS_PADDING:i,ARROW_WIDTH:h});f.exports=k;}),null);
__d('AggregatedMapMarker',['DOM','Style'],(function a(b,c,d,e,f,g){function h(i,j){this._root=i;this._sprite=j;}Object.assign(h.prototype,{setPosition:function i(j){var k=j.y-this._sprite.getAnchorY(),l=j.x-this._sprite.getAnchorX();c('Style').set(this._root,'top',Math.round(k)+'px');c('Style').set(this._root,'left',Math.round(l)+'px');},setOnClick:function i(j){this._root.onclick=j;},setOnMouseover:function i(j){this._root.onmouseover=j;},setOnMouseout:function i(j){this._root.onmouseout=j;},remove:function i(){c('DOM').remove(this._root);},getElement:function i(){return this._root;}});f.exports=h;}),null);
__d("AggregatedMapZIndex",[],(function a(b,c,d,e,f,g){var h={};Object.assign(h,{DEFAULT_PIN_BASE_Z_INDEX:1000,PIN_Z_INDEX_MAXIMUM_ADD:4000,DEFAULT_PIN_MAX_Z_INDEX:5000,CONTROLS_Z_INDEX:7000,CALLOUT_Z_INDEX:9000,TOOLTIP_Z_INDEX:9100});f.exports=h;}),null);
__d('LegacyMapUtils',['clamp','mod'],(function a(b,c,d,e,f,g){'use strict';var h={MIN_LATITUDE:-85.05112878,MAX_LATITUDE:85.05112878,MIN_LONGITUDE:-180,MAX_LONGITUDE:180,pows:{},MAX_ZOOM:20,BING_MAP_ZOOM_LEVEL_CITY:10,BING_MAP_ZOOM_LEVEL_REGION:6,EARTH_CIRCUMFERENCE_METERS:40074784,scale:function i(j,k){var l=k-j;if(!h.pows[l])h.pows[l]=Math.pow(2,l);return h.pows[l];},mapSize:function i(j){return 512*h.scale(1,j);},latLongToXY:function i(j,k){var l=c('clamp')(j.latitude,h.MIN_LATITUDE,h.MAX_LATITUDE),m=(j.longitude+180)/360,n=Math.sin(l*Math.PI/180),o=.5-Math.log((1+n)/(1-n))/(4*Math.PI),p=h.mapSize(k);return {x:Math.floor(m*(p-1)+.5),y:Math.floor(o*(p-1)+.5)};},xyToLatLong:function i(j,k){var l=h.mapSize(k),m=c('mod')(j.x,l)/l-.5,n=.5-c('clamp')(j.y,0,l-1)/l,o=90-360*Math.atan(Math.exp(-n*2*Math.PI))/Math.PI,p=360*m;return {latitude:o,longitude:p};},getViewForLatLongs:function i(j,k,l,m,n,o){if(!l.length)throw new Error('the proper view for zero point(s) is completely ambiguous');m=m||{t:0,r:0,b:0,l:0};n=n||1;o=o||Infinity;var p=h._getBoundingBox(l),q=m.l+m.r,r=m.t+m.b,s=h.MAX_ZOOM,t;if(l.length>1){t=h.mapSize(s);while(s>n&&(h._getWidth(p,t)>j-q||p.b-p.t>k-r)||s>o){p=h._rectScale(p,1,2);s--;t=h.mapSize(s);}}else while(s!==h.BING_MAP_ZOOM_LEVEL_CITY){s--;p=h._rectScale(p,1,2);}var u=p.l-m.l,v=p.r+m.r;if(v<u)v+=h.mapSize(s);var w={t:p.t-m.t,r:v,b:p.b+m.b,l:u};t=h.mapSize(s);var x={x:(w.l+w.r)/2,y:(w.t+w.b)/2},y=h.xyToLatLong(x,s);return {center:y,width:j,height:k,zoom:s};},_getWidth:function i(j,k){return h._calculateRightDistanceAToB(j.l,j.r,k);},_getBoundingBox:function i(j){var k=[],l=h.mapSize(h.MAX_ZOOM);for(var m=0;m<j.length;m++){var n=j[m];k.push(h.latLongToXY(n,h.MAX_ZOOM));}k.sort(function(w,x){return w.x-x.x;});var o=k.length-1,p=h._calculateRightDistanceAToB(k[o].x,k[0].x,l),q=0,r=o,s=[k[0].y],t;for(var u=1;u<k.length;u++){s.push(k[u].y);var v=h._calculateRightDistanceAToB(k[u-1].x,k[u].x,l);if(v>p){p=v;q=u;r=u-1;}}t={t:Math.min.apply(null,s),r:k[r].x,b:Math.max.apply(null,s),l:k[q].x};return t;},_calculateRightDistanceAToB:function i(j,k,l){if(!l)throw new Error('zero or null map width not allowed');return (l+k-j)%l;},_rectScale:function i(j,k,l){return {t:j.t*k/l,r:j.r*k/l,b:j.b*k/l,l:j.l*k/l};}};f.exports=h;}),null);
__d('LegacyMapCoordinate',['LegacyMapUtils','Vector','mod'],(function a(b,c,d,e,f,g){function h(){'use strict';this.absoluteX=null;this.absoluteY=null;this.latitude=null;this.longitude=null;}h.fromAbsolute=function(i,j){'use strict';if(j===undefined){j=i.y;i=i.x;}var k=new h();k.absoluteX=i;k.absoluteY=j;var l=c('LegacyMapUtils').xyToLatLong(new (c('Vector'))(i,j),h.MAX_ZOOM);k.latitude=l.latitude;k.longitude=l.longitude;return k;};h.fromLatLong=function(i,j){'use strict';if(j===undefined){j=i.longitude;i=i.latitude;}var k=new h();k.latitude=i;k.longitude=j;var l=c('LegacyMapUtils').latLongToXY({latitude:i,longitude:j},h.MAX_ZOOM);k.absoluteX=l.x;k.absoluteY=l.y;return k;};h.fromMap=function(i,j,k){'use strict';var l=c('LegacyMapUtils').scale(k,h.MAX_ZOOM);return h.fromAbsolute(i*l,j*l);};h.prototype.getLatitude=function(){'use strict';return this.latitude;};h.prototype.getLongitude=function(){'use strict';return this.longitude;};h.prototype.getAbsoluteX=function(){'use strict';return this.absoluteX;};h.prototype.getAbsoluteY=function(){'use strict';return this.absoluteY;};h.prototype.getAbsoluteXY=function(){'use strict';return new (c('Vector'))(this.absoluteX,this.absoluteY);};h.prototype.getMapX=function(i){'use strict';return this.getMapXY(i).x;};h.prototype.getMapY=function(i){'use strict';return this.getMapXY(i).y;};h.prototype.getMapXY=function(i){'use strict';var j=c('LegacyMapUtils').scale(h.MAX_ZOOM,i),k=this.absoluteX*j,l=this.absoluteY*j;return new (c('Vector'))(k,l);};h.prototype.add=function(i,j){'use strict';var k=this.getMapXY(i);return h.fromMap(k.x+j.x,k.y+j.y,i);};h.prototype.calculateDistanceSq=function(i,j){'use strict';var k=this.calculateDistanceX(i,j),l=this.calculateDistanceY(i,j);return k*k+l*l;};h.prototype.calculateDistanceX=function(i,j){'use strict';var k=c('LegacyMapUtils').mapSize(i),l=c('mod')(j.getMapX(i)-this.getMapX(i),k);return Math.min(l,k-l);};h.prototype.calculateDistanceY=function(i,j){'use strict';return Math.abs(j.getMapY(i)-this.getMapY(i));};Object.assign(h,{MAX_ZOOM:18,MIN_ZOOM:1});f.exports=h;}),null);
__d('AggregatedMapGroup',['AggregatedMapMarker','AggregatedMapZIndex','LegacyMapCoordinate','DOM','Rect','Style','clamp'],(function a(b,c,d,e,f,g){function h(i,j,k,l){this._boundingBox=j;this._sprite=k;this._marker=null;this._mapToPixel=l;this.pins=i;this.deleted=false;}Object.assign(h.prototype,{getType:function i(){return 'AggregatedMapGroup';},getCenter:function i(){return this._mapToPixel(this._boundingBox.getCenter());},getCenterLatLong:function i(j){var k=this._boundingBox.getCenter(),l=c('LegacyMapCoordinate').fromMap(k.x,k.y,j);return {latitude:l.getLatitude(),longitude:l.getLongitude()};},hasMarker:function i(){return !!this._marker;},dismissMarker:function i(){if(this._marker){this._marker.remove();this._marker=null;}},getMarker:function i(){return this._marker&&this._marker.getElement();},getSprite:function i(){return this._sprite;},updatePosition:function i(j){if(!this._marker)return;var k=this.getCenter();this._marker.setPosition(k);},getSpriteBounds:function i(){var j=this._sprite,k=this.getCenter().y-j.getAnchorY(),l=this.getCenter().x-j.getAnchorX(),m=l+j.getWidth(),n=k+j.getHeight(),o=new (c('Rect'))(k,m,n,l);o.calloutY=k+j.getCalloutY();return o;},isSinglePin:function i(){return this.pins.length==1;},renderMarker:function i(j){if(!this._marker){var k=this._sprite,l=k.render();this._marker=new (c('AggregatedMapMarker'))(l,this._sprite);if(this.isSinglePin()){var m=k.getBaseZIndex&&k.getBaseZIndex()||c('AggregatedMapZIndex').DEFAULT_PIN_BASE_Z_INDEX;m+=c('clamp')(Math.floor(this.getCenter().y),0,c('AggregatedMapZIndex').PIN_Z_INDEX_MAXIMUM_ADD);if(k.setZIndex){k.setZIndex(Math.floor(m));}else c('Style').set(l,'z-index',Math.floor(m));}c('DOM').appendContent(j,l);}return this._marker;},add:function i(j,k){return this._boundingBox.add(j,k);}});f.exports=h;}),null);
__d('MapAggregation',['removeFromArray'],(function a(b,c,d,e,f,g){function h(){this.combine=null;this.iterations=0;this.candidates=null;this.loners=null;}Object.assign(h.prototype,{aggregate:function i(j,k,l){this.overlap=l?l:this._overlap;this.candidates=j;this.combine=k;this.loners=[];while(this.candidates.length>0){var m=this.candidates[this.candidates.length-1],n;do{var o=m.center;this._group(m,Number.MAX_VALUE);n=o!==m.center;}while(!this._isDeleted(m)&&n);if(!this._isDeleted(m)){c('removeFromArray')(this.candidates,m);this.loners.push(m);}}return this.loners;},_isDeleted:function i(j){return j.center===null;},_delete:function i(j){c('removeFromArray')(this.candidates,j);c('removeFromArray')(this.loners,j);j.center=null;},_group:function i(j,k){while(true){this.iterations++;if(this.iterations>=10000){this.iterations%10000===0&&0;return;}var l=this._nearest(j),m=l.nearest,n=l.distanceSquared;if(!m||n>k||!this.overlap(j,m))return;var o=m.center,p=j.center;this._group(m,n-1);if(this._isDeleted(j))return;var q=m.center!==o,r=j.center!==p;if(!q&&!r){this.combine(j,m);this._delete(m);return;}}},_nearest:function i(j){var k,l,m,n=null,o=Number.MAX_VALUE;for(k=0;k<this.candidates.length;k++){m=this.candidates[k];if(m===j)continue;l=this._distanceSquared(j,m);if(l<o){n=m;o=l;}}for(k=0;k<this.loners.length;k++){m=this.loners[k];if(m===j)continue;l=this._distanceSquared(j,m);if(l<o){n=m;o=l;}}return {nearest:n,distanceSquared:o};},_overlap:function i(j,k){var l=j.radius+k.radius;return this._distanceSquared(j,k)<l*l;},_distanceSquared:function i(j,k){var l=j.center.x-k.center.x,m=j.center.y-k.center.y;return l*l+m*m;}});f.exports=h;}),null);
__d('MapRects',['Rect','Vector','clamp'],(function a(b,c,d,e,f,g){function h(){}Object.assign(h,{containsPoint:function i(j,k,l){if(l===undefined)l=0;return j.t<=k.y+l&&j.r>=k.x-l&&j.b>=k.y-l&&j.l<=k.x+l;},pad:function i(j,k){return h.padXY(j,k,k);},padX:function i(j,k){return h.padXY(j,k,0);},padY:function i(j,k){return h.padXY(j,0,k);},padXY:function i(j,k,l){return new (c('Rect'))(j.t-l,j.r+k,j.b+l,j.l-k,j.domain);},collides:function i(j,k){return (j.t<k.b&&j.b>k.t&&j.l<k.r&&j.r>k.l);},boundPoint:function i(j,k){var l=new (c('Vector'))(0,0);l.x=c('clamp')(k.x,j.l,j.r);l.y=c('clamp')(k.y,j.t,j.b);return l;},boundingBox:function i(j,k){return new (c('Rect'))(Math.min(j.t,k.t),Math.max(j.r,k.r),Math.max(j.b,k.b),Math.min(j.l,k.l));},scale:function i(j,k,l){return new (c('Rect'))(j.t*k/l,j.r*k/l,j.b*k/l,j.l*k/l);}});f.exports=h;}),null);
__d('AggregatedMap',['csx','Event','AggregatedMapCallout','AggregatedMapCalloutOrientation','AggregatedMapGroup','AggregatedMapZIndex','Arbiter','LegacyMapCoordinate','LegacyMapUtils','CSS','DOM','GeoRectangle','leaflet','MapAggregation','MapRects','Rect','Run','Style','Vector','clamp','$'],(function a(b,c,d,e,f,g,h){var i=10,j=7,k=100,l=50,m=500,n=409,o=90,p=90,q=.15,r=10,s=10,t=10,u=new (c('Rect'))(50,50,50,50);function v(w,x,y,z,aa,ba,ca){this.mapReady=false;this.lastZoom=null;this.initialView=null;this.lastRender=null;this.visiblePins=[];this.groups=[];this.callouts=[];this.zoomStack=[];this.initialPinsToHide=[];this.arrowYOffset=p;this.padding=k+l;this.topLeft=c('LegacyMapCoordinate').fromLatLong(0,0);this.dynamicMap=w;this.canvas=x;this.instanceid=y;this.logger=ba;this.maxZoom=z.maxZoom;this.minZoom=z.minZoom;this.maxCalloutWidth=z.maxCalloutWidth||z.width-i;this.maxCalloutHeight=z.maxCalloutHeight||z.height-i;this.pad={};this.setViewportPadding(z.paddingTop,z.paddingRight,z.paddingBottom,z.paddingLeft);this.listeners=[];this.bingMapEvents=[];c('Run').onLeave(this._onBeforeLeave.bind(this));this.dynamicMap.onInit(this._onInit.bind(this,aa,ca));}Object.assign(v.prototype,{CALLOUT_MARGIN:10,noPanningStrategy:function w(x){return this._noPan.bind(this,x);},leftRightNoPanningStrategy:function w(){return this._leftRightNoPan.bind(this);},anchoredPanningStrategy:function w(x,y){return this._anchoredPan.bind(this,x,y);},smartPanningStrategy:function w(x,y){return this._smartPan.bind(this,x,y);},getMap:function w(){this._assertInitialized();return this.map;},setPins:function w(x){this._assertInitialized();this.visiblePins=x;this.calloutAnchor=null;this._setZoomButtonVisibility();this._aggregate();},getGroups:function w(){return this.groups;},getWidth:function w(){return this._getW()-this.pad.l-this.pad.r;},getAbsoluteWidth:function w(){return this._getW();},getHeight:function w(){return this._getH()-this.pad.t-this.pad.b;},getAbsoluteHeight:function w(){return this._getH();},getBounds:function w(){var x=this.dynamicMap.getBounds();return new (c('GeoRectangle'))(x.getNorth(),x.getWest(),x.getSouth(),x.getEast());},pushView:function w(){this._assertInitialized();this.zoomStack.push(this._getMapView());},invalidateSize:function w(){this.dynamicMap.invalidateSize();},zoomIntoOne:function w(x,y){this._assertInitialized();this.pushView();this.zoomToOne(x,y);},zoomToOne:function w(x,y,z){this.zoomToOneTight(x,y,0,z);},zoomToOneTight:function w(x,y,z,aa){this._assertInitialized();y=y||new (c('Vector'))(0,0);z=z||0;aa=aa||false;z=Math.max(this._findMinZoomWherePinIsAlone(x),z,this.getZoom());x.setZoom(z);var ba=x.anchor.add(z,y.mul(-1));this._setMapView({zoom:z,center:{latitude:ba.getLatitude(),longitude:ba.getLongitude()},animate:aa},c('Arbiter').BEHAVIOR_PERSISTENT);},zoomInto:function w(x){this._assertInitialized();this.pushView();this.zoomTo(x);},removePin:function w(x){this._assertInitialized();this.removePins([x]);},removePins:function w(x){this._assertInitialized();for(var y=0;y<x.length;y++)x[y]._aggregated_map_remove=true;var z=[];for(var aa=0;aa<this.visiblePins.length;aa++)if(!this.visiblePins[aa]._aggregated_map_remove)z.push(this.visiblePins[aa]);for(var ba=0;ba<x.length;ba++)delete x[ba]._aggregated_map_remove;this.visiblePins=z;this._aggregate();},addPins:function w(x){this._assertInitialized();this.visiblePins=this.visiblePins||[];for(var y=0;y<x.length;y++)this.visiblePins.push(x[y]);this._aggregate();},addPin:function w(x){this._assertInitialized();this.addPins([x]);},zoomOut:function w(){this._assertInitialized();this.logger&&this.logger.bumpTap('zoom-out');this.zoomDelta(-1,true);},zoomIn:function w(){this._assertInitialized();this.logger&&this.logger.bumpTap('zoom-in');this.zoomDelta(1,true);},zoomBack:function w(){this._assertInitialized();this.logger&&this.logger.bumpTap('snap-back');var x;if(this.zoomStack.length){x=this.zoomStack.pop();}else{x={};Object.assign(x,this.initialView);x.zoom=Math.min(x.zoom,this.getZoom());}this._setMapView(x);},setInitialView:function w(){this._assertInitialized();this.initialView=this._getMapView();var x=c('DOM').scry(this.canvas,"span.__0")[0];x&&c('CSS').hide(x);},closeCalloutAndZoomBack:function w(){this._assertInitialized();this.hideCallout();this.zoomBack();},onAddPin:function w(x,y){var z=y.pin,aa=y.content;this.hideCallout();this.addPin(z);this.zoomIntoOne(z);this.openCallout(z,aa);},zoomDelta:function w(x,y){x=c('clamp')(this.getZoom()+x,this.minZoom,this.maxZoom)-this.getZoom();if(!x)return;var z=null;if(y&&this._getPrimaryCalloutAnchorGroup()){z=this._getPrimaryCalloutAnchorGroup().getCenter();var aa=!c('MapRects').containsPoint(new (c('Rect'))(0,this._getW(),this._getH(),0),z);if(aa)z=null;}if(z===null)z={x:this._getW()/2+this._getCenterOffset().x,y:this._getH()/2+this._getCenterOffset().y};var ba=this.map.tryPixelToLocation(c('leaflet').point(z.x,z.y)),ca=c('leaflet').point(z.x-this.map.getWidth()/2,z.y-this.map.getHeight()/2);this._zoom(true,x,ba,ca);},getZoom:function w(){return this.map.getZoom();},getCenter:function w(){return this.map.getCenter();},getView:function w(){return this._getMapView();},setView:function w(x){this._assertInitialized();this._setMapView(x);},setViewportPadding:function w(x,y,z,aa){this.pad.t=x;this.pad.r=y;this.pad.b=z;this.pad.l=aa;},redraw:function w(){this._assertInitialized();this._aggregate();},zoomTo:function w(x,y){this._assertInitialized();if(x.length<1)return;var z=this.maxZoom;if(x.length<r)while(this._aggregateZoom(x,z-1).length==x.length&&z>=s)z--;var aa=[];for(var ba=0;ba<x.length;ba++){var ca={latitude:x[ba].getLatitude(),longitude:x[ba].getLongitude()};aa.push(ca);}var da=c('LegacyMapUtils').getViewForLatLongs(this._getW(),this._getH(),aa,u,this.minZoom,z);delete da.height;delete da.width;da.animate=y;this._setMapView(da,c('Arbiter').BEHAVIOR_PERSISTENT);},hideCallout:function w(x){this._assertInitialized();var y=this._getPrimaryCalloutAnchor();this._getInternalCallout().close();if(y&&!x)this._inform('calloutHidden');},throbber:function w(x){x=x||n;return c('AggregatedMapCallout').throbber(x);},openCallout:function w(x,y,z){if(this._getTooltipCallout().getAnchor()===x)this._getTooltipCallout().close();this._getInternalCallout().setContent(y);this._getInternalCallout()._map_moveTo(x,z);return this._getInternalCallout();},getCallout:function w(){return this._getInternalCallout();},setExternalCalloutAnchor:function w(x){this._externalCalloutAnchor=x;},openTooltip:function w(x,y,z){if(this._getInternalCallout().getAnchor()===x)return;this._getTooltipCallout().setContent(y);this._getTooltipCallout()._map_moveTo(x,z);return this._getTooltipCallout();},getTooltip:function w(){return this._getTooltipCallout();},updateCallouts:function w(){for(var x=0;x<this.callouts.length;x++)this.callouts[x]._map_updatePosition();},_onInit:function w(x,y){this.map=this.dynamicMap;this.bingMapEvents=[{name:'movestart move',callback:this._onViewChange},{name:'moveend',callback:this._onViewChangeEnd},{name:'mouseup',callback:this._onMouseUp},{name:'mousedown',callback:this._onMouseDown},{name:'zoomstart',callback:this._onZoomStart}];this.bingMapEvents.forEach(function(ba){this.map.on(ba.name,ba.callback,this);},this);this._onViewChange();this.initialized=true;for(var z=0;z<x.length;z++)x[z].xhp&&this.initialPinsToHide.push(x[z].xhp);x.length&&this.setPins(x);if(y){x[0].setCallout(c('$')(y));this._getInternalCallout()._map_moveTo(x[0],this.noPanningStrategy(c('AggregatedMapCalloutOrientation').TOP));}c('CSS').hide(c('DOM').scry(this.canvas,'.fbAggregatedMapCalloutShell')[0]);for(var aa in v.Listeners)this._subscribe('AggregatedMap/'+aa,this[aa].bind(this));this._inform(v.Events.ready,this,c('Arbiter').BEHAVIOR_STATE);},_callout_getAnchorBounds:function w(x){var y=this._getCalloutAnchorGroup(x),z=y&&y.getSpriteBounds();return z;},_callout_panTo:function w(x,y,z){var aa=this._callout_getAnchorBounds(x),ba=z?z(y,aa):null;if(ba){var ca=c('LegacyMapUtils').xyToLatLong(this.dynamicMap.pixelToMap(ba),this.getZoom());this._setMapView({center:ca});}},_callout_determineArrowYOffset:function w(x,y,z,aa){var ba=this._callout_getAnchorBounds(x.getAnchor()),ca=new (c('Vector'))((ba.l+ba.r)/2,ba.calloutY),da=aa/2,ea=this._getVisibleBounds(),fa=c('MapRects').containsPoint(this._getNoPanBounds(aa),ca,1),ga=da;if(y||fa){var ha=ea.t+da+this.CALLOUT_MARGIN,ia=ea.b-(aa-da)-this.CALLOUT_MARGIN;ga+=ca.y-c('clamp')(ca.y,ha,ia);}ga=c('clamp')(ga,c('AggregatedMapCallout').ARROW_WIDTH/2,aa-c('AggregatedMapCallout').ARROW_WIDTH/2);return ga;},_createCallout:function w(x){var y=c('DOM').scry(this.canvas,'.fbAggregatedMapCalloutShell')[0],z=y.cloneNode(true);c('DOM').appendContent(this.canvas,z);c('Style').set(z,'z-index',x);var aa=new (c('AggregatedMapCallout'))(this,z);this.callouts.push(aa);return aa;},_getInternalCallout:function w(){this.internalCallout=this.internalCallout||this._createCallout(c('AggregatedMapZIndex').CALLOUT_Z_INDEX);return this.internalCallout;},_getTooltipCallout:function w(){this.tooltipCallout=this.tooltipCallout||this._createCallout(c('AggregatedMapZIndex').TOOLTIP_Z_INDEX);return this.tooltipCallout;},_assertInitialized:function w(){},_guard:function w(x){return function(y,z){if(!(!z||!z._instanceid))if(z._instanceid===this.instanceid)return x(y,z);}.bind(this);},_subscribe:function w(x,y){this.listeners.push(c('Arbiter').subscribe(x,this._guard(y)));},_inform:function w(x,y,z){y=y||{};y._instanceid=this.instanceid;c('Arbiter').inform('AggregatedMap/'+x,y,z);},_bubbleClick:function w(x){this._inform(v.Events.bubbleClick,x);},_bubbleMouseover:function w(x){this._inform(v.Events.bubbleMouseover,x);},_bubbleMouseout:function w(x){this._inform(v.Events.bubbleMouseout,x);},_pinClick:function w(x){if(x._agg_map_callout)if(this.getCallout().getAnchor()===x){this.hideCallout();}else this.openCallout(x,x._agg_map_callout);this._inform(v.Events.pinClick,x);},_pinMouseover:function w(x){if(x.name){var y=c('DOM').create('span');c('CSS').addClass(y,'fbAggregatedMapTooltipText');c('DOM').setContent(y,x.name);this.openTooltip(x,y,this.leftRightNoPanningStrategy());}this._inform(v.Events.pinMouseover,x);},_pinMouseout:function w(x){if(this.tooltipCallout&&this.tooltipCallout.getAnchor()===x&&x.name)this.tooltipCallout.close();this._inform(v.Events.pinMouseout,x);},_getVisibleBounds:function w(){return new (c('Rect'))(this.pad.t,this._getW()-this.pad.r,this._getH()-this.pad.b,this.pad.l);},_getCenterOffset:function w(){return {x:(this.pad.l-this.pad.r)/2,y:(this.pad.t-this.pad.b)/2};},_setMapView:function w(x,y){var z=this._getCenterOffset();if(x.centerOffset){z.x+=x.centerOffset.x;z.y+=x.centerOffset.y;}x.centerOffset=c('leaflet').point(z.x,z.y);if(x.center)x.center=c('leaflet').latLng(x.center.latitude,x.center.longitude);this.map.setView(x);},_findMinZoomWherePinIsAlone:function w(x){if(this.visiblePins.length<2)return this.minZoom;var y=Number.MAX_VALUE,z=null,aa=x.anchor.getAbsoluteXY();for(var ba=0;ba<this.visiblePins.length;ba++){var ca=this.visiblePins[ba],da=ca.anchor.getAbsoluteXY().distanceTo(aa);if(da<y&&ca!==x){y=da;z=ca;}}var ea=x.getAggregationRadius()+z.getAggregationRadius(),fa=this.maxZoom;while(y/2>ea&&fa>this.minZoom){fa--;y/=2;}while(fa<this.maxZoom){var ga=this._aggregateZoom(this.visiblePins,fa),ha=false;for(var ia=0;ia<ga.length;ia++){var ja=ga[ia];if(ja.members.length==1&&ja.members[0]===x)return fa;}fa++;}return fa;},_smartPan:function w(x,y,z,aa){x=x||this.maxCalloutWidth;y=y||this.maxCalloutHeight;var ba=c('MapRects').pad(this._getNoPanBounds(y),m-this.CALLOUT_MARGIN),ca=new (c('Vector'))(aa.getCenter().x,aa.calloutY);if(c('MapRects').containsPoint(ba,ca)){var da=this._getVisibleBounds(),ea=ca.sub(c('MapRects').boundPoint(this._getNoPanBounds(y),ca)),fa=aa.w()/2+c('AggregatedMapCallout').ARROW_HEIGHT_PLUS_PADDING+x+this.CALLOUT_MARGIN;if(ca.x>da.getCenter().x){z.setOrientation(c('AggregatedMapCalloutOrientation').LEFT);if(!ea.x)ea.x=ca.x-Math.max(ca.x,fa+da.l);}else{z.setOrientation(c('AggregatedMapCalloutOrientation').RIGHT);if(!ea.x)ea.x=ca.x-Math.min(ca.x,da.r-fa);}var ga=null;if(ea.magnitude()>=1)ga=new (c('Vector'))(this._getW()/2+ea.x+this._getCenterOffset().x,this._getH()/2+ea.y+this._getCenterOffset().y);return ga;}return this._anchoredPan(v.Anchor.DEFAULT,c('AggregatedMapCalloutOrientation').RIGHT,this._getInternalCallout(),aa);},_leftRightNoPan:function w(x,y){if(y.getCenter().x>this._getVisibleBounds().getCenter().x){x.setOrientation(c('AggregatedMapCalloutOrientation').LEFT);}else x.setOrientation(c('AggregatedMapCalloutOrientation').RIGHT);},_noPan:function w(x,y,z){y.setOrientation(x);},_anchoredPan:function w(x,y,z,aa){var ba=this._getVisibleBounds();z.setOrientation(y);if(x===v.Anchor.DEFAULT)x=new (c('Vector'))(ba.getCenter().x-this.maxCalloutWidth/2-aa.w()/2,ba.getCenter().y-q*this._getH()-p+c('AggregatedMapCallout').ARROW_WIDTH/2);return aa.getCenter().sub(x).add(new (c('Vector'))(this._getW()/2,this._getH()/2));},_renderOverlay:function w(){if(!this.mapReady)return;this.lastRender=this.topLeft;var x,y=new (c('Rect'))(-this.padding,this._getW()+this.padding,this._getH()+this.padding,-this.padding);for(var z=0;z<this.groups.length;z++){x=this.groups[z];var aa=x.getCenter();if(c('MapRects').containsPoint(y,aa)){var ba=x.renderMarker(this.canvas);if(x.pins.length>1){ba.setOnClick(this._bubbleClick.bind(this,x));ba.setOnMouseover(this._bubbleMouseover.bind(this,x));ba.setOnMouseout(this._bubbleMouseout.bind(this,x));}else{ba.setOnClick(this._pinClick.bind(this,x.pins[0]));ba.setOnMouseover(this._pinMouseover.bind(this,x.pins[0]));ba.setOnMouseout(this._pinMouseout.bind(this,x.pins[0]));}}else x.dismissMarker();}this._position();while(this.initialPinsToHide.length)c('CSS').hide(this.initialPinsToHide.pop());},_getNoPanBounds:function w(x){var y=this._getVisibleBounds();return c('MapRects').pad(new (c('Rect'))(y.t+o,y.r,y.b-o,y.l),-this.CALLOUT_MARGIN);},_getCalloutAnchorGroup:function w(x){return x&&(x.group||x);},_getPrimaryCalloutAnchor:function w(){return this._getInternalCallout().getAnchor()||this._externalCalloutAnchor;},_getPrimaryCalloutAnchorGroup:function w(){return this._getCalloutAnchorGroup(this._getPrimaryCalloutAnchor());},_zoom:function w(x,y,z,aa){y=Math.max(c('LegacyMapCoordinate').MIN_ZOOM,Math.min(this.getZoom()+y,c('LegacyMapCoordinate').MAX_ZOOM));this.map.setView({animate:x,zoom:y,center:z,centerOffset:aa});},_getMapView:function w(){return {center:this.map.getCenter(),zoom:this.map.getZoom(),width:this.map.getWidth(),height:this.map.getHeight()};},_setZoomButtonVisibility:function w(){var x=c('DOM').scry(this.canvas,"label.__1")[0],y=c('DOM').scry(this.canvas,"label.__2")[0];x&&c('CSS').conditionClass(x,"uiButtonDisabled",this.getZoom()>=this.maxZoom);y&&c('CSS').conditionClass(y,"uiButtonDisabled",this.getZoom()<=this.minZoom);},_aggregate:function w(){this.logger&&this.logger.startRun('_aggregate');var x,y=this._aggregateZoom(this.visiblePins,this.getZoom()),z=[];for(var aa=0;aa<y.length;aa++){var ba=y[aa];x=new (c('AggregatedMapGroup'))(ba.members,ba.rect,ba.sprite,this.dynamicMap.mapToPixel.bind(this.dynamicMap));z.push(x);for(var ca=0;ca<ba.members.length;ca++)ba.members[ca].group=x;}for(var da=0;da<this.groups.length;da++){x=this.groups[da];x.dismissMarker();x.deleted=true;}for(var ea=0;ea<this.callouts.length;ea++)if(this.callouts[ea].getAnchor()&&this.callouts[ea].getAnchor().getType()==='AggregatedMapGroup')this.callouts[ea].close();this.groups=z;this._renderOverlay();this.logger&&this.logger.endRun('_aggregate');},_combine:function w(x,y){for(var z=0;z<y.members.length;z++)x.members.push(y.members[z]);x.rect=c('MapRects').boundingBox(x.rect,y.rect);x.sprite=x.sprite.combine(y.sprite);x.radius=x.sprite.getAggregationRadius();x.center=x.rect.getCenter();x.single=0;return x;},_overlap:function w(x,y){var z=x.center.y-y.center.y,aa=x.center.x-y.center.x;if(x.single+y.single==1)if(x.single&&z>j/2){z-=j;}else if(y.single&&-z<j/2)z+=j;var ba=x.radius+y.radius;return aa*aa+z*z<ba*ba;},_aggregateZoom:function w(x,y){for(var z=0;z<x.length;z++){x[z].setZoom(y);var aa=x[z].center;x[z].rect=new (c('Rect'))(aa.y,aa.x,aa.y,aa.x);x[z].single=1;}var ba=[],ca=[];for(var da=0;da<x.length;da++){var ea=x[da],fa={};Object.assign(fa,ea);fa.radius=ea.getAggregationRadius();fa.members=[ea];if(fa.radius){ba.push(fa);}else ca.push(fa);}if(y<this.maxZoom&&ba.length>1)ba=new (c('MapAggregation'))().aggregate(ba,this._combine.bind(this),this._overlap.bind(this));return ba.concat(ca);},_position:function w(){this.logger&&this.logger.startRun('_position');var x=this._getW()/2;for(var y=0;y<this.groups.length;y++)this.groups[y].updatePosition(x);this.updateCallouts();this.logger&&this.logger.endRun('_position');},_getDims:function w(){return new (c('Vector'))(this._getW(),this._getH());},_getH:function w(){return this.map.getHeight();},_getW:function w(){return this.map.getWidth();},_onMapClick:function w(){this._inform(v.Events.mapClick);},_onViewChangeEnd:function w(){this._inform(v.Events.viewChangeEnd,this._getMapView(),c('Arbiter').BEHAVIOR_STATE);},_onViewChange:function w(){this.mapReady=true;this._inform(v.Events.viewChange,this._getMapView(),c('Arbiter').BEHAVIOR_STATE);this.topLeft=c('LegacyMapCoordinate').fromLatLong(this.getCenter()).add(this.getZoom(),this._getDims().mul(-.5));if(this.lastZoom!==this.getZoom()){this.lastZoom=this.getZoom();while(this.zoomStack.length&&this.getZoom()<=this.zoomStack[this.zoomStack.length-1].zoom)this.zoomStack.pop();this._setZoomButtonVisibility();this._aggregate();}else if(!this.lastRender||this.topLeft.calculateDistanceX(this.getZoom(),this.lastRender)>k||this.topLeft.calculateDistanceY(this.getZoom(),this.lastRender)>k){this._renderOverlay();}else this._position();var x=c('DOM').scry(this.canvas,"span.__0")[0];x&&c('CSS').conditionShow(x,this._showSnapBack());},_showSnapBack:function w(){if(this.zoomStack.length){return true;}else if(this.initialView){var x=this.initialView;if(this.getZoom()>x.zoom){return true;}else{var y=this._getMapView(),z=t/c('LegacyMapUtils').scale(1,this.getZoom());return Math.abs(y.center.latitude-x.center.latitude)>z||Math.abs(y.center.longitude-x.center.longitude)>z;}}return false;},_onMouseDown:function w(x){this.xDown=x.pageX;this.yDown=x.pageY;},_onMouseUp:function w(x){if(this.xDown==x.pageX&&this.yDown==x.pageY)this._onMapClick();},_onZoomStart:function w(x){for(var y=0;y<this.groups.length;y++)this.groups[y].dismissMarker();},_onBeforeLeave:function w(){for(var x=0;x<this.listeners.length;x++)this.listeners[x].unsubscribe();this.bingMapEvents.forEach(function(y){this.map.off(y.name,y.callback,this);},this);}});Object.assign(v,{Anchor:{DEFAULT:'default_anchor'},Events:{calloutHidden:'calloutHidden',ready:'ready',mapClick:'mapClick',viewChange:'viewChange',viewChangeEnd:'viewChangeEnd',bubbleClick:'bubbleClick',bubbleMouseover:'bubbleMouseover',bubbleMouseout:'bubbleMouseout',pinClick:'pinClick',pinMouseover:'pinMouseover',pinMouseout:'pinMouseout',onSearchSubmit:'onSearchSubmit'},Listeners:{hideCallout:'hideCallout',zoomDelta:'zoomDelta',zoomIn:'zoomIn',zoomOut:'zoomOut',zoomBack:'zoomBack',closeCalloutAndZoomBack:'closeCalloutAndZoomBack',onAddPin:'onAddPin'},inform:function w(x,event,y,z){if(!y){y={};y._instanceid=x;}c('Arbiter').inform('AggregatedMap/'+event,y,z);},listenThenInform:function w(x,y,z,aa){c('Event').listen(y,z,function(){v.inform(x,aa);});},subscribe:function w(x,event,y){c('Arbiter').subscribe('AggregatedMap/'+event,v._guard(x,y));},subscribeAll:function w(x,y){for(var z in v.Events){var aa=y['aggregatedMapHandler_'+z];if(aa){aa=aa.bind(y);v.subscribe(x,z,aa);}}},_guard:function w(x,y){return function(z,aa,ba){if(!ba._instanceid){throw new Error('aggregated map didnt pass instanceid');}else if(ba._instanceid!==x)return;return z(ba);}.bind(this,y);}});f.exports=v;}),null);
__d('AggregatedMapCircleSprite',['DOM'],(function a(b,c,d,e,f,g){function h(m,n,o,p){this._size=m;this._radius=n;if(p){this.chooseAggregationRadius=p;this._aggregationRadius=p(this._size);}this._count=o;}function i(){return this._radius;}function j(){return this._radius*2;}function k(m){switch(m){case h.SIZE_SMALL:return 9;case h.SIZE_MEDIUM:return 11;case h.SIZE_LARGE:return 16;}}function l(m){var n;if(this.chooseAggregationRadius){n=this.chooseAggregationRadius;}else n=k;var o=this.getCount()+m.getCount();if(o>=100){return h.large(o,n);}else if(o>=10){return h.medium(o,n);}else return h.small(o,n);}Object.assign(h.prototype,{render:function m(){var n=c('DOM').create('div',{className:['fbAggregatedMapBubble','fbAggregatedMapBubble'+this._size].join(' ')});c('DOM').setContent(n,this._count);var o=c('DOM').create('div',{className:['fbAggregatedMapBubbleShell','fbAggregatedMapBubbleShell'+this._size].join(' ')});c('DOM').setContent(o,n);this._root=o;return o;},combine:l,getCount:function m(){return this._count;},getHeight:j,getWidth:j,getAnchorX:i,getAnchorY:i,getCalloutX:i,getCalloutY:i,getAggregationRadius:function m(){return this._aggregationRadius;}});Object.assign(h,{RADIUS_SMALL:15,RADIUS_MEDIUM:20,RADIUS_LARGE:28,SIZE_SMALL:'Small',SIZE_MEDIUM:'Medium',SIZE_LARGE:'Large',small:function m(n,o){return new h(h.SIZE_SMALL,h.RADIUS_SMALL,n,o);},medium:function m(n,o){return new h(h.SIZE_MEDIUM,h.RADIUS_MEDIUM,n,o);},large:function m(n,o){return new h(h.SIZE_LARGE,h.RADIUS_LARGE,n,o);},combine:l});f.exports=h;}),null);
__d('AggregatedMapPin',['LegacyMapCoordinate'],(function a(b,c,d,e,f,g){function h(i,j,k,l,m){this.anchor=c('LegacyMapCoordinate').fromLatLong(i);this.sprite=j;this.name=k||null;this.group=null;this.xhp=l;this.profileID=m;}Object.assign(h.prototype,{getType:function i(){return 'AggregatedMapPin';},setZoom:function i(j){this.center=this.anchor.getMapXY(j);},getLatitude:function i(){return this.anchor.getLatitude();},getLongitude:function i(){return this.anchor.getLongitude();},getGroup:function i(){return this.group;},getAggregationRadius:function i(){return this.sprite.getAggregationRadius();},setSprite:function i(j){this.sprite=j;},setCallout:function i(j){this._agg_map_callout=j;}});Object.assign(h,{create:function i(j,k,l,m){return new h(j,k,l,m);}});f.exports=h;}),null);
__d('AggregatedMapRedPinSprite',['AggregatedMapCircleSprite','CSS','DOM'],(function a(b,c,d,e,f,g){function h(i,j,k,l,m,n,o,p,q){this.size=i;this.image=j;this.width=k;this.height=l;this.calloutY=m;this.aggregationRadius=n;this.text=p;this.count=o;this.css=q;}Object.assign(h.prototype,{render:function i(){var j=c('DOM').create('div');c('CSS').addClass(j,'fbAggregatedMapPin');c('CSS').addClass(j,'fbAggregatedMapPin'+this.size);if(this.css)c('CSS').addClass(j,this.css);var k='/images/places/map/'+this.image,l=c('DOM').create('img',{src:k});c('DOM').appendContent(j,l);var m=null;if(this.text){m=c('DOM').create('div');c('CSS').addClass(m,'fbAggregatedMapPinText');c('CSS').addClass(m,'fbAggregatedMapPinText'+this.size);c('DOM').setContent(m,this.count);c('DOM').appendContent(j,m);}return j;},combine:c('AggregatedMapCircleSprite').combine,getCount:function i(){return this.count;},getHeight:function i(){return this.height;},getWidth:function i(){return this.width;},getAnchorX:function i(){return this.width/2;},getAnchorY:function i(){return this.height;},getCalloutX:function i(){return this.width/2;},getCalloutY:function i(){return this.calloutY;},getAggregationRadius:function i(){return this.aggregationRadius;}});Object.assign(h,{dot:function i(j){if(j===undefined)j=1;return new h('Small','small_dot.png',17,22,8,10,j,false);},smallBlank:function i(j){return new h('Small','small_blank.png',17,22,8,10,j,true);},mediumBlank:function i(j){return new h('Medium','medium_blank.png',25,34,12,14,j,true);},largeBlank:function i(j){return new h('Large','large_blank.png',29,43,14,17,j,true);}});f.exports=h;}),null);
__d('TimelineMapPlace',['arrayContains'],(function a(b,c,d,e,f,g){function h(i){this.stories=[];this.creation=false;this.name=null;i.latitude||(i.latitude=0);i.longitude||(i.longitude=0);Object.assign(this,i);if(this.region)this.region=this.region+':'+this.country;this.visibleStories=this.stories;}Object.assign(h.prototype,{setFilters:function i(j){var k=[];for(var l=0;l<this.stories.length;l++)if(!j||c('arrayContains')(this.stories[l].categories,j))k.push(this.stories[l]);this.visibleStories=k;},getStories:function i(j,k){if(j===undefined)j=true;var l=j?this.visibleStories:this.stories;if(!k){return l;}else{var m=[];for(var n=0;n<l.length;n++){var o=l[n];if(k(o))m.push(o);}return m;}},count:function i(j,k){var i=this.getStories(j,k).length;if(this.creation)i++;return i;}});Object.assign(h,{Filters:{MLE:function i(j){return j&&!j.isEnt;},ALL:null}});f.exports=h;}),null);
__d("TimelineMapStory",[],(function a(b,c,d,e,f,g){function h(i){Object.assign(this,i);}f.exports=h;}),null);
__d('TimelineMapController',['AggregatedMap','shield','AggregatedMapCalloutOrientation','AggregatedMapPin','AggregatedMapRedPinSprite','Arbiter','AsyncRequest','LegacyMapCoordinate','CSS','DOM','MapRects','PageEvents','Rect','Style','TimelineMapPlace','TimelineMapStory','Vector','$','isEmpty','mod','randomShuffle'],(function a(b,c,d,e,f,g){var h=198,i=132,j=108;function k(l,m,n,o,p,q,r){this.profileID=null;this.viewasID=null;this.places={};this.visiblePins=null;this.stories={};this.hiddenStories={};this.placesByTime=[];this.category=null;this.pending=null;this.waitingOnConfirmation=false;this.highlightedPin=null;this.arbiterListeners=[];this.calloutBeingFetched=null;this.initialized=false;this._lastResizeCalloutAnchor=null;this._lastResizeCalloutStoryHeight=null;this._lastResizeCalloutStory=null;this._scrollableCalloutController=null;this.inCreation=false;this.lastTypeaheadEvent=null;this.initialPosition=null;this.initialPlace=null;this.initialStory=null;this.hh=0;this.ww=0;this.smartPan=null;this.requestID=0;this.asyncRequests={};this.intervals=[];this.groups=[];this.pagerIndex=null;this.categoryCountUnique={};if(l)this._init(l,m,n,o,p,q,r);}Object.assign(k.prototype,{HOVER_FETCH_DELAY:100,HOVER_DISMISS_DELAY:300,MAP_BOTTOM_PADDING:40,MIN_MAP_HEIGHT:532,MIN_CALLOUT_STORY_HEIGHT:200,MAX_CALLOUT_HEIGHT:600,RESIZE_CHECK_INTERVAL:50,HOVERCARD_WIDTH:279,HOVERCARD_HEIGHT:251,HOVERCARD_CLOSED:undefined,HOVERCARD_WAITING_TO_FETCH:1,HOVERCARD_BEING_FETCHED:2,HOVERCARD_OPEN:3,HOVERCARD_WAITING_TO_DISMISS:4,TIMELINE_MAP_HOVERCARD_PLACE:'Place',TIMELINE_MAP_HOVERCARD_CITY:'City',TIMELINE_MAP_HOVERCARD_REGION:'Region',TIMELINE_MAP_HOVERCARD_COUNTRY:'Country',HOVERCARD_CITY_REGION_HEURISTIC:3,setCategory:function l(m){this.logger&&this.logger.startRun('set-category');this.map.hideCallout();this.category=m;this._filter();},setCategoryCountUnique:function l(m){this.categoryCountUnique=m;},getCategories:function l(){var m={},n,o;for(var p in this.places){var q=this.places[p],r={};for(var s=0;s<q.stories.length;s++){o=q.stories[s];if(o.categories)for(var t=0;t<o.categories.length;t++){n=o.categories[t];if(!m[n])m[n]={count:0,name:n};if(!r[n])r[n]=1;m[n].count++;}}}return m;},zoomToVisible:function l(){this.map.zoomTo(this.visiblePins);},cleanupCreationCallout:function l(m){this.map.hideCallout(m);this._cleanUpHighlightedPin();},cancelCreation:function l(m){if(!this.inCreation)return;this.inCreation=false;this.cleanupCreationCallout();},creationFinished:function l(m,n){var o=n.place,p=n.story,q=n.showCallout;this.inCreation=false;this.waitingOnConfirmation=false;this.cleanupCreationCallout();this.addStories(null,{stories:[p],places:[o]});if(q)this.showCallout(null,{place_id:o.id,story_id:p.id});},page:function l(m){var n=this.map.getGroups();if(!n)return;var o=[],p=true,q=0;for(var r=0;r<n.length;r++){var s=n[r];if(s.hasMarker()){var t=s.getCenter(),u=new (c('Rect'))(0,this.ww,this.hh,0);if(c('MapRects').containsPoint(u,t)){o.push(s);if(s===this.groups[q]){q++;}else if(p)p=false;}}}p=p&&q===this.groups.length;if(!p){this.groups=o;this.sortedGroups=o.concat([]).sort(function(w,x){return w.getCenter().x-x.getCenter().x;});if(m>0){this.pagerIndex=0;}else this.pagerIndex=-1;}else this.pagerIndex+=m>0?1:-1;this.pagerIndex=c('mod')(this.pagerIndex,this.sortedGroups.length);var v=this.sortedGroups[this.pagerIndex];if(v.pins.length>1){this._openCallout(v,this.map.throbber(325),this.map.leftRightNoPanningStrategy());v.hoverPermanent=true;v.hoverState=this.HOVERCARD_WAITING_TO_FETCH;this._fetchHovercard(v);}else this.aggregatedMapHandler_pinClick(null,v.pins[0]);},hovercard:function l(m,n){var o=this._getAsyncContext(n.requestID);if(o.deleted||o.hoverState!==this.HOVERCARD_BEING_FETCHED)return;o.hoverState=this.HOVERCARD_OPEN;var l=c('DOM').create('div');l.onmouseover=function(){if(!this.map||!this.map.getCallout().getAnchor())return null;this.aggregatedMapHandler_bubbleMouseover(null,this.map.getCallout().getAnchor());}.bind(this);l.onmouseout=function(){if(!this.map||!this.map.getCallout().getAnchor())return null;this.aggregatedMapHandler_bubbleMouseout(null,this.map.getCallout().getAnchor());}.bind(this);c('CSS').setClass(l,'fbTimelineMapHovercard');c('DOM').setContent(l,n.content);if(o===this.map.getCallout().getAnchor()){this.map.getCallout().setContent(l);}else this._openCallout(o,l,this.map.leftRightNoPanningStrategy());this.map.getCallout().recalculateArrowYOffset(true);this.logger&&this.logger.endRun('load-hovercard');},callout:function l(m,n){var o=this._getAsyncContext(n.requestID);if(this.map.getCallout().getAnchor()!==o)return;this._openCallout(o,n.content);this.logger&&this.logger.endRun('load-callout');},addPending:function l(m,n){var o=n.count;this.pending=this.pending||0;this.pending+=o;this._checkReady();},hideCallout:function l(m,n){n=n||{};n._instanceid=this.instanceID;c('Arbiter').inform('AggregatedMap/hideCallout',n);},addStories:function l(m,n){var o=n.stories,p=n.places;if(n.count)this.pending=(this.pending||0)-n.count;var q,r,s,t;for(t=0;t<p.length;t++){r=new (c('TimelineMapPlace'))(p[t]);if(!this.places[r.id]){this.places[r.id]=r;this.placesByTime.push(r);}r.mostRecentTimestamp=0;}for(t=0;t<o.length;t++){s=new (c('TimelineMapStory'))(o[t]);this.stories[s.id]=s;q=s.placeID;r=this.places[q];r.stories.push(s);r.mostRecentTimestamp=Math.max(r.mostRecentTimestamp,s.timestamp);}if(n.count===undefined){this._refresh();}else this._checkReady();},updateStory:function l(m,n){var o=n.place,p=n.story,q=this.stories[p.id];if(q.placeID!=o.id){var r={};r[q.id]=true;this._removeStories(q.placeID,r);this.addStories(null,{stories:[p],places:[o]});}this._showCallout(this.places[o.id].pin,o.id,p.id);},deleteStory:function l(m,n){var o=this.map.getCallout().getAnchor(),p=this.stories[n];if(!p)return;var q={};q[p.id]=true;this.map.hideCallout();var r=this._removeStories(p.placeID,q);r.stories_removed&&this._refresh();!r.place_removed&&this._showCallout(o,o.place.id);},hideStory:function l(m,n){var o=this.map.getCallout().getAnchor(),p=this.stories[n.story_id];if(!o)return;if(o.getType()!=='AggregatedMapPin')return;if(!p||p.placeID!=o.place.id)return;var q=c('$')(n.story_domid);c('CSS').hide(q);var r=c('DOM').insertAfter(q,n.undo_html)[0];this.hiddenStories[p.id]={story_domid:q.id,undo_domid:r.id};},undoHideStory:function l(m,n){var o=this.stories[n],p=this.hiddenStories[o.id];c('DOM').remove(p.undo_domid);c('CSS').show(p.story_domid);delete this.hiddenStories[o.id];},showCallout:function l(m,n){var o=this.places[n.place_id].pin;this._showCallout(o,n.place_id,n.story_id);},zoomIntoOne:function l(m,n){var o=this.places[n.place_id];this._zoomToPlace(o);},zoomToArea:function l(m,n){var o=n.type,p=n.key,q=[];for(var r in this.places){var s=this.places[r],t=s.pin;if(s.city===p&&o===this.TIMELINE_MAP_HOVERCARD_CITY||s.region===p&&o===this.TIMELINE_MAP_HOVERCARD_REGION||s.country===p&&o===this.TIMELINE_MAP_HOVERCARD_COUNTRY)q.push(t);}this.map.zoomInto(q);},creationFlow:function l(m,n){var o=n.place,p={latitude:o.latitude,longitude:o.longitude};this.waitingOnConfirmation=false;this._highlightPlace(o.id,p);this._openCallout(this.highlightedPin,n.content,this.smartPan);this.inCreation=true;},highlightMapPlace:function l(m,n){if(n.dismiss&&this.waitingOnConfirmation)return;if(n.showThrobber){this._openCallout(this.highlightedPin,this.map.throbber(),this.smartPan);return;}this.map.hideCallout();if(n.dismiss){this._cleanUpHighlightedPin();}else if(n.selected){this.waitingOnConfirmation=true;}else if(n.center)this._highlightPlace(n.placeID,n.center);this.map.setView(n);},registerScrollableCallout:function l(m,n){this._scrollableCalloutController=n;},_init:function l(m,n,o,p,q,r,s){this.profileID=m;this.viewasID=n.viewas;this.mapContainer=o;this.canvas=c('DOM').find(this.mapContainer,'.fbAggregatedMapContainer');this.logger=q;this.instanceID=p;this._dynamicSize=n.dynamicSize;if(n.center)this.initialPosition={latitude:n.center.lat,longitude:n.center.long};this.initialPlace=n.highlightedPlace;this.initialStory=n.highlightedStory;this.enableHovercards=n.enableHovercards;this.calloutDiv=r&&c('$')(r);this.maxCalloutHeight=this.MAX_CALLOUT_HEIGHT;if(n.maxCalloutHeight&&n.maxCalloutHeight<this.MAX_CALLOUT_HEIGHT)this.maxCalloutHeight=n.maxCalloutHeight;if(s){s.subscribe('next',this.page.bind(this,1));s.subscribe('previous',this.page.bind(this,-1));}this.border=c('$')('fbTimelineMapBorder');this._subscribe(c('PageEvents').AJAXPIPE_ONUNLOAD,this._onBeforeLeave.bind(this));this._subscribe('AggregatedMap/ready',this._onInit.bind(this));this._subscribe('AggregatedMap/calloutHidden',this.cancelCreation.bind(this));this._subscribe('AggregatedMap/calloutHidden',c('shield')(c('Arbiter').inform,null,'reflow'));this._subscribe('TimelineMapStickyHeaderComposer/typeaheadFocus',this._handleTypeahead.bind(this,'focus'));this._subscribe('TimelineMapStickyHeaderComposer/typeaheadBlur',this._handleTypeahead.bind(this,'blur'));this._subscribe('TimelineMapStickyHeaderComposer/typeaheadSelect',this._handleTypeahead.bind(this,'select'));},_onInit:function l(m,n){this.map=n;if(this._dynamicSize){this._resizeMap();this.intervals=[setInterval(this._resizeMap.bind(this),this.RESIZE_CHECK_INTERVAL),setInterval(this.resizeCallout.bind(this),this.RESIZE_CHECK_INTERVAL)];}else{this.hh=this.map.getHeight();this.ww=this.map.getWidth();}this.initialized=true;for(var o in k.Listeners)this._subscribe('TimelineMap/'+o,this[o].bind(this));for(var p in c('AggregatedMap').Events){var q=this['aggregatedMapHandler_'+p];if(q){q=q.bind(this);this._subscribe('AggregatedMap/'+p,q);}}this.smartPan=this.map.smartPanningStrategy();},_getAsyncContext:function l(m){var n=this.asyncRequests[m];delete this.asyncRequests[m];return n;},_storeAsyncContext:function l(m){var n=this.requestID++;this.asyncRequests[n]=m;return n;},_inform:function l(m,n,o){n=n||{};n._instanceid=this.instanceID;k.inform('TimelineMap/'+m,n,o);},_cleanUpHighlightedPin:function l(){if(this.highlightedPin){if(this.highlightedPin.isPreview){this.map.removePin(this.highlightedPin);}else{this.highlightedPin.setSprite(this._getPlaceSprite(this.highlightedPin.place));this.map.redraw();}this.highlightedPin=null;c('CSS').removeClass(this.canvas,'fbTimelineMapDimPinMode');}},_handleTypeahead:function l(m){!this.inCreation&&m=='blur'&&this.lastTypeaheadEvent=='focus';this.lastTypeaheadEvent=m;},_checkReady:function l(){if(this.pending!==0)return;this._refresh();if(this.logger){window._cstart&&this.logger.set('flushTTI',Date.now()-window._cstart);for(var m in this.places){var n=this.places[m];this.logger.bump('places');this.logger.bump('stories',n.count());}this.logger.set('profileID',this.profileID);}if(window.CavalryLogger)window.CavalryLogger.getInstance().measurePageLoad(true);var o=this.initialPlace,p=this.initialStory;if(o){this.map.zoomTo(this.visiblePins,false);this.map.setInitialView();var q=this.places[o].pin;if(q){var r=new (c('Vector'))(h,i);r=r.sub(new (c('Vector'))(this.ww/2,this.hh/2));this.map.zoomIntoOne(q,r);var s=c('DOM').find(this.calloutDiv,'.fbTimelineMapCallout');c('DOM').remove(this.calloutDiv);this._openCallout(q,s);this.map.getCallout().setArrowYOffset(j);this.map.updateCallouts();}}else if(this.initialPosition){this.map.setView({center:this.initialPosition});}else{this.map.zoomTo(this.visiblePins,false);this.map.setInitialView();}c('CSS').addClass(this.border,'fbTimelineMapContainerLoaded');},_refresh:function l(){this.placesByTime=this.placesByTime.sort(function(m,n){return m.mostRecentTimestamp-n.mostRecentTimestamp;});this._filter();this._inform(k.Events.updateCategories,null,c('Arbiter').BEHAVIOR_STATE);},_resizeMap:function l(){var m=c('Vector').getViewportDimensions().y,n=c('Vector').getElementPosition(this.border).y,o=c('Vector').getElementDimensions(this.border).y,p=m-(n+o),q=this.hh+p-this.MAP_BOTTOM_PADDING;q=Math.max(this.MIN_MAP_HEIGHT,Math.min(q,m));if(Math.abs(this.hh-q)>1){c('Style').set(this.mapContainer,'height',q+'px');this.map.invalidateSize();this.hh=q;this.ww=this.map.ww;this._resizeMap();}},resizeCallout:function l(){var m=this.map.getCallout().getContent(),n=c('DOM').scry(m,'.fbTimelineMapScrollableStory');for(var o=n.length-1;o>=0;o--)if(!c('CSS').hasClass(n[o],'hidden_elem')){var p=n[o],q=c('DOM').find(p,'.fbTimelineMapCalloutStory');break;}if(!(m&&q&&p))return;var r=c('Vector').getElementDimensions(q).y;if(this.map.getCallout().getAnchor()===this._lastResizeCalloutAnchor&&r===this._lastResizeCalloutStoryHeight&&q===this._lastResizeCalloutStory)return;var s=c('DOM').find(m,'.fbTimelineMapCalloutHeader'),t=c('Vector').getElementDimensions(s).y,u=c('Vector').getElementPosition(p).y,v=c('Vector').getElementPosition(this.mapContainer).y,w=this.hh-this.map.CALLOUT_MARGIN,x=Math.max(this.MIN_CALLOUT_STORY_HEIGHT,Math.min(v+w-u,w-t)),y=Math.min(r,x,this.maxCalloutHeight);c('Style').set(p,'height',y+'px');this._lastResizeCalloutAnchor=this.map.getCallout().getAnchor();this._lastResizeCalloutStoryHeight=r;this._lastResizeCalloutStory=q;if(this._scrollableCalloutController)this._scrollableCalloutController.adjustGripper();this.map.getCallout()._updateDimensions();this.map.getCallout().recalculateArrowYOffset();},_filter:function l(){var m=[];for(var n in this.places){var o=this.places[n];o.setFilters(this.category);if(o.count()>0){var p=this._getPlaceSprite(o),q=c('AggregatedMapPin').create(o,p,o.name);o.pin=q;q.place=o;m.push(q);}}this.visiblePins=m;if(this.highlightedPin)this.visiblePins.push(this.highlightedPin);this.map.setPins(m);},_getPlaceSprite:function l(m){var n=m.getStories(),o=n.length,p;if(o>=100){p=c('AggregatedMapRedPinSprite').largeBlank(o);}else if(o>10){p=c('AggregatedMapRedPinSprite').mediumBlank(o);}else if(o>1){p=c('AggregatedMapRedPinSprite').smallBlank(o);}else if(n[0]&&n[0].pin){p=c('AggregatedMapRedPinSprite').mediumBlank(1);p.text=false;p.image=n[0].pin+'.png';}else p=c('AggregatedMapRedPinSprite').dot();return p;},_getHighlightedSprite:function l(){var m=c('AggregatedMapRedPinSprite').dot();m.aggregationRadius=0;m.css='fbTimelineMapHighlighted';return m;},_highlightPlace:function l(m,n){this._cleanUpHighlightedPin();var o;if(m&&this.places[m]!==undefined){o=this.places[m].pin;o.setSprite(this._getHighlightedSprite());this.map.redraw();}else{o=new (c('AggregatedMapPin'))(c('LegacyMapCoordinate').fromLatLong(n),this._getHighlightedSprite());o.isPreview=true;this.map.addPin(o);}this.highlightedPin=o;c('CSS').addClass(this.canvas,'fbTimelineMapDimPinMode');return o;},_showCallout:function l(m,n,o){if(this.map.getCallout()&&this.map.getCallout().getOrientation()){var p=this.map.getCallout().getOrientation()===c('AggregatedMapCalloutOrientation').LEFT,q=new (c('Vector'))(p?200:-200,-100);this.map.zoomIntoOne(m,q);}this._openCallout(m,this.map.throbber(),this.smartPan);this._fetchCallout(m,n,o);},_fetchCallout:function l(m,n,o){this.logger&&this.logger.startRun('load-callout');var p=this._storeAsyncContext(m),q=this.places[n],r=[],s={},t=q.getStories();for(var u=0;u<t.length;++u){var v=t[u];if(!v.isEnt){r.push(v.unitParams);}else{s[v.storyType]=s[v.storyType]||[];s[v.storyType].push(v.id);}}var w={profile_id:this.profileID,targetid:q.id,storyid:o,unitparams:r,storiesbytype:s,request_id:p};if(this.viewasID&&this.viewasID!="0")w.viewas=this.viewasID;new (c('AsyncRequest'))().setURI('/ajax/timeline/map/callout.php').setMethod('POST').setData(w).send();},_openCallout:function l(m,n,o){var p=this.map.getCallout().getAnchor();p&&this._dismissHovercard(p);this.map.openCallout(m,n,o);this.resizeCallout();},_zoomToPlace:function l(m){var n=c('AggregatedMapCalloutOrientation').LEFT,o=c('AggregatedMapCalloutOrientation').RIGHT,p=this.map.getCallout().getOrientation()===n,q=new (c('Vector'))(p?200:-200,-100);this.map.zoomIntoOne(m.pin,q);this._openCallout(m.pin,this.map.throbber(),this.map.noPanningStrategy(p?n:o));this._fetchCallout(m.pin,m.id);},_fetchHovercard:function l(m){this.logger&&this.logger.startRun('load-hovercard');if(m.deleted||m.hoverState!==this.HOVERCARD_WAITING_TO_FETCH)return;if(m.pins.length<2)throw new Error('bubble has < 2 pins!');delete m.timeoutToken;m.hoverState=this.HOVERCARD_BEING_FETCHED;var n=[],o=[],p={},q={},r={},s={},t={},u={};m.pins.forEach(function(ra){var sa=ra.place,ta=sa.getStories();u[sa.id]=true;for(var ua=0;ua<ta.length;ua++)n.push(ta[ua]);o.push(sa);if(sa.city){p[sa.city]=p[sa.city]||0;p[sa.city]++;if(sa.region)t[sa.region]=sa.city;if(sa.country)s[sa.country]=sa.city;}if(sa.region){q[sa.region]=q[sa.region]||0;q[sa.region]++;}if(sa.country){r[sa.country]=r[sa.country]||0;r[sa.country]++;}});var v=o.length,w=this._storeAsyncContext(m),x=this._getStoriesByType(n).TimelineMapStoryPhoto||[],y=x.length,z=c('randomShuffle')(x).slice(0,4),aa={},ba=o.length<=3,ca=o.sort(function(ra,sa){return sa.getStories().length-ra.getStories().length;}).slice(0,3).map(function(ra){var sa=0,ta={},ua=ra.getStories();for(var va=0;va<ua.length;va++){var wa=ua[va],xa=wa.visitID;if(xa===0){sa++;}else if(!(xa in ta)){ta[xa]=true;sa++;}}aa[ra.id]=sa;return ra.id;}),da=false,ea=false,fa=false;for(var ga in this.places){var ha=this.places[ga];if(!u[ha.id]&&(fa=fa||r[ha.country])&&(ea=ea||q[ha.region])&&(da=da||p[ha.city]))break;}var ia=null,ja=null,ka=null,la=null,ma=null,na=function ra(sa,ta,ua){return sa[ua]-sa[ta];};p=Object.keys(p).sort(na.bind(null,p));q=Object.keys(q).sort(na.bind(null,q));r=Object.keys(r).sort(na.bind(null,r));var oa={};oa[this.TIMELINE_MAP_HOVERCARD_COUNTRY]=r.map(function(ra){return s[ra];});oa[this.TIMELINE_MAP_HOVERCARD_REGION]=q.map(function(ra){return t[ra];});oa[this.TIMELINE_MAP_HOVERCARD_CITY]=p;oa[this.TIMELINE_MAP_HOVERCARD_PLACE]=o.map(function(ra){return ra.id;});if(r.length>0)if(!fa){ja=this.TIMELINE_MAP_HOVERCARD_COUNTRY;if(r.length>1){la=this.TIMELINE_MAP_HOVERCARD_COUNTRY;}else if(q.length>1){la=this.TIMELINE_MAP_HOVERCARD_REGION;}else la=this.TIMELINE_MAP_HOVERCARD_CITY;}if(q.length>0&&!ja){var pa=this.HOVERCARD_CITY_REGION_HEURISTIC;if(!ea||q.length>1&&p.length>q.length*pa){ja=this.TIMELINE_MAP_HOVERCARD_REGION;if(q.length>1){la=this.TIMELINE_MAP_HOVERCARD_REGION;}else la=this.TIMELINE_MAP_HOVERCARD_CITY;}}if(p.length>0&&!ja)if(!da||p.length>1){ja=this.TIMELINE_MAP_HOVERCARD_CITY;if(p.length>1){la=this.TIMELINE_MAP_HOVERCARD_CITY;}else ma=o.length;}if(!ja){ja=this.TIMELINE_MAP_HOVERCARD_PLACE;ma=-1;}ia=oa[ja];if(la)ka=oa[la];var qa={profile_id:this.profileID,request_id:w,target_count:v,photo_count:y,photo_ids:z,place_counts:aa,target_ids:ca,all_places:ba,ids:ia,title_type:ja,subtitle_count:ma,links:ka,link_type:la};if(this.viewasID&&this.viewasID!="0")qa.viewas=this.viewasID;new (c('AsyncRequest'))().setURI('/ajax/timeline/map/hovercard.php').setMethod('POST').setData(qa).send();},_dismissHovercard:function l(m){delete m.timeoutToken;delete m.hoverState;delete m.hoverPermanent;if(this.map.getCallout().getAnchor()===m)this.map.hideCallout();},_getStoriesByType:function l(m){var n={};m.forEach(function(o){n[o.storyType]=n[o.storyType]||[];n[o.storyType].push(o.isEnt?o.id:o.unitParams);});return n;},_removeStories:function l(m,n){var o=0,p=false,q=this.places[m],r=[],s;for(s=0;s<q.stories.length;++s){var t=q.stories[s];if(n[t.id]){delete this.stories[t.id];++o;}else r.push(t);}if(r.length===0){delete this.places[m];p=true;}else q.stories=r;return {place_removed:p,stories_removed:o};},_removeHiddenStories:function l(){var m=this.map.getCallout().getAnchor();if(!m)return;if(m.getType()!=='AggregatedMapPin')return;if(c('isEmpty')(this.hiddenStories))return;var n=m.place.id,o=this._removeStories(n,this.hiddenStories);if(o.stories_removed!==0){this._refresh();this.hiddenStories={};}},_guard:function l(m){return function(n,o){if(!o||!o._instanceid||o._instanceid===this.instanceID)m(n,o);}.bind(this);},_subscribe:function l(m,n){this.arbiterListeners.push(c('Arbiter').subscribe(m,this._guard(n)));},aggregatedMapHandler_mapClick:function l(){this._removeHiddenStories();this.map.hideCallout();this._inform(k.Events.mapClick);},aggregatedMapHandler_pinClick:function l(m,n){this.logger&&this.logger.bumpTap('pin-click');this._removeHiddenStories();if(this.map.getCallout().getAnchor()===n){this.map.hideCallout();}else this._showCallout(n,n.place.id);},aggregatedMapHandler_bubbleClick:function l(m,n){this.logger&&this.logger.bumpTap('bubble-click');this.map.hideCallout();this.map.zoomInto(n.pins);},aggregatedMapHandler_bubbleMouseover:function l(m,n){if(!this.enableHovercards||n.hoverPermanent)return;if(!n.hoverState||n.hoverState===this.HOVERCARD_CLOSED){n.hoverState=this.HOVERCARD_WAITING_TO_FETCH;n.timeoutToken=setTimeout(this._fetchHovercard.bind(this,n),this.HOVER_FETCH_DELAY);}else if(n.hoverState===this.HOVERCARD_WAITING_TO_DISMISS){clearTimeout(n.timeoutToken);delete n.timeoutToken;n.hoverState=this.HOVERCARD_OPEN;}},aggregatedMapHandler_bubbleMouseout:function l(m,n){if(n.hoverPermanent)return;if(n.hoverState===this.HOVERCARD_WAITING_TO_FETCH||n.hoverState===this.HOVERCARD_BEING_FETCHED){clearTimeout(n.timeoutToken);delete n.timeoutToken;delete n.hoverState;}else if(n.hoverState===this.HOVERCARD_OPEN){n.timeoutToken=setTimeout(this._dismissHovercard.bind(this,n),this.HOVER_DISMISS_DELAY);n.hoverState=this.HOVERCARD_WAITING_TO_DISMISS;}},_onBeforeLeave:function l(){for(var m=0;m<this.arbiterListeners.length;m++)this.arbiterListeners[m].unsubscribe();for(var n=0;n<this.intervals.length;n++)clearInterval(this.intervals[n]);this.logger=null;this.map=null;this.places=null;}});Object.assign(k,{Events:{updateCategories:'updateCategories',mapClick:'mapClick'},Listeners:{addStories:'addStories',updateStory:'updateStory',deleteStory:'deleteStory',hideStory:'hideStory',undoHideStory:'undoHideStory',addPending:'addPending',creationFlow:'creationFlow',cleanupCreationCallout:'cleanupCreationCallout',cancelCreation:'cancelCreation',creationFinished:'creationFinished',showCallout:'showCallout',callout:'callout',resizeCallout:'resizeCallout',hovercard:'hovercard',highlightMapPlace:'highlightMapPlace',registerScrollableCallout:'registerScrollableCallout',zoomToVisible:'zoomToVisible',hideCallout:'hideCallout',zoomIntoOne:'zoomIntoOne',zoomToArea:'zoomToArea'},inform:function l(m,n,o){if(!n||!n._instanceid)return;return c('Arbiter').inform(m,n,o||c('Arbiter').BEHAVIOR_PERSISTENT);}});f.exports=k;}),null);
__d('TimelineMonitor',['Arbiter','Event','Run','Vector','ViewportBounds','ge','queryThenMutateDOM'],(function a(b,c,d,e,f,g){var h={},i={},j=0,k=[],l=null,m=false;function n(){h={};i={};j=0;k.length=0;l&&l.remove();l=null;m=false;}function o(){if(!l)l=c('Event').listen(window,'scroll',t);if(!m){c('Run').onLeave(n);m=true;}t();}var p=[],q=[];function r(){k.forEach(function(y){var z=u.getSection(y);if(z&&z!==i[y.id]){i[y.id]=z;p.push({section:z});}});var v=c('ViewportBounds').getTop()+c('Vector').getScrollPosition().y;for(var w in h){var x=h[w];if(v>=x.boundary&&j<=x.boundary||v<=x.boundary&&j>=x.boundary){h[w].fromAbove=j<v;q.push(h[w]);}}j=v;}function s(){p.forEach(function(v){c('Arbiter').inform(u.SECTION_CHANGE,v);});q.forEach(function(v){c('Arbiter').inform(u.BOUNDARY_PASSED,v);});p.length=0;q.length=0;}function t(){c('queryThenMutateDOM')(r,s,'TimelineMonitor/scroll');}var u={BOUNDARY_PASSED:'TimelineMonitor/boundary',SECTION_CHANGE:'TimelineMonitor/change',getSection:function v(w){var x=c('ViewportBounds').getTop()+c('Vector').getScrollPosition().y,y=w.childSections.getHead();while(y){if(c('ge')(y.nodeID)&&x<c('Vector').getElementPosition(y.getNode()).y+c('Vector').getElementDimensions(y.getNode()).y)return y;y=y.getNext();}},monitorBoundary:function v(w,x){x=x||w;if(!h[x]||h[x].boundary!==w){h[x]={boundary:w,id:x};o();}},monitorSection:function v(w){i[w.id]=null;k.push(w);o();return u.getSection(w);},poke:function v(w){t();}};f.exports=u;}),null);
__d('TimelinePlacesSubCollection',['cx','Arbiter','CSS','Event','TimelineMapController','tidyEvent'],(function a(b,c,d,e,f,g,h){var i="_3s-";function j(k){'use strict';this.$TimelinePlacesSubCollection1=k.id;this.$TimelinePlacesSubCollection2=k.parent_collection;this.$TimelinePlacesSubCollection3=k.sub_tab;this.$TimelinePlacesSubCollection4=k.entity_id;this.$TimelinePlacesSubCollection5=k.collection_token;this.$TimelinePlacesSubCollection6=k.profile_id;this.$TimelinePlacesSubCollection7=k.places_filter;this.$TimelinePlacesSubCollection8=k.city_id;this.$TimelinePlacesSubCollection9=null;this.$TimelinePlacesSubCollection10=0;this.$TimelinePlacesSubCollection11=0;}j.prototype.hide=function(){'use strict';this.$TimelinePlacesSubCollection3&&c('CSS').hasClass(this.$TimelinePlacesSubCollection3,i)&&c('CSS').removeClass(this.$TimelinePlacesSubCollection3,i);var k=this.$TimelinePlacesSubCollection2.getMapInstanceID();if(k!=null)c('Arbiter').inform('TimelineMap/hideCallout',{_instanceid:k},c('Arbiter').BEHAVIOR_PERSISTENT);};j.prototype.show=function(){'use strict';!c('CSS').hasClass(this.$TimelinePlacesSubCollection3,i)&&c('CSS').addClass(this.$TimelinePlacesSubCollection3,i);this.$TimelinePlacesSubCollection12();c('Arbiter').subscribe('AggregatedMap/ready',this.$TimelinePlacesSubCollection13(this.$TimelinePlacesSubCollection12.bind(this)));};j.prototype.getSubTabNode=function(){'use strict';return this.$TimelinePlacesSubCollection3;};j.prototype.getParentCollection=function(){'use strict';return this.$TimelinePlacesSubCollection2;};j.prototype.getEntityID=function(){'use strict';return this.$TimelinePlacesSubCollection4;};j.prototype.$TimelinePlacesSubCollection12=function(){'use strict';var k=this.$TimelinePlacesSubCollection2.getMapInstanceID();if(k==null)return;c('Arbiter').inform('TimelineMap/zoomToArea',{_instanceid:k,type:c('TimelineMapController').prototype.TIMELINE_MAP_HOVERCARD_CITY,key:this.$TimelinePlacesSubCollection8},c('Arbiter').BEHAVIOR_PERSISTENT);};j.prototype.$TimelinePlacesSubCollection13=function(k){'use strict';return function(l,m){if(!m||!m.$TimelinePlacesSubCollection14||m.$TimelinePlacesSubCollection14===this.$TimelinePlacesSubCollection2.getMapInstanceID())k(l,m);}.bind(this);};j.prototype.$TimelinePlacesSubCollection15=function(){'use strict';if(this.getParentCollection().getActiveSubCollection()===this)return true;return false;};j.build=function(k,l,m,n,o,p,q){'use strict';if(k!=null&&l&&m&&m.sub_tab&&m.entity_id!=null&&n&&o!=null&&p!=null&&q!=null){var r={id:k,parent_collection:l,sub_tab:m.sub_tab,entity_id:m.entity_id,collection_token:n,profile_id:o,places_filter:p,city_id:q},s=new j(r);c('tidyEvent')(c('Event').listen(s.getSubTabNode(),'click',function(t){s.getParentCollection().setActiveSubCollection(s);}));return s;}return null;};f.exports=j;}),null);
__d('TimelinePlacesCollection',['csx','cx','CSS','DOM','DOMDimensions','DOMQuery','MenuItem','TimelineAppCollection','TimelinePlacesSubCollection','ProfileOverviewSection'],(function a(b,c,d,e,f,g,h,i){var j,k,l=820;j=babelHelpers.inherits(m,c('TimelineAppCollection'));k=j&&j.prototype;function m(n){'use strict';k.constructor.call(this,n);this.$TimelinePlacesCollection1=n.token;this.$TimelinePlacesCollection2=null;this.$TimelinePlacesCollection3=null;this.$TimelinePlacesCollection4=[];this.$TimelinePlacesCollection5=null;this.$TimelinePlacesCollection6=null;}m.prototype.reset=function(){'use strict';k.reset.call(this);this.$TimelinePlacesCollection2=null;this.$TimelinePlacesCollection3=null;this.$TimelinePlacesCollection4=[];};m.prototype.show=function(){'use strict';this.$TimelinePlacesCollection2&&c('CSS').show(this.$TimelinePlacesCollection2);};m.prototype.hide=function(){'use strict';this.$TimelinePlacesCollection2&&c('CSS').hide(this.$TimelinePlacesCollection2);};m.prototype.setActiveSubCollection=function(n){'use strict';this.$TimelinePlacesCollection3&&this.$TimelinePlacesCollection3.hide();this.$TimelinePlacesCollection3=n;this.$TimelinePlacesCollection3&&this.$TimelinePlacesCollection3.show();};m.prototype.getSubCollectionWithID=function(n){'use strict';if(0<=n&&this.$TimelinePlacesCollection4&&n<this.$TimelinePlacesCollection4.length)return this.$TimelinePlacesCollection4[n];return null;};m.prototype.getMapInstanceID=function(){'use strict';return this.$TimelinePlacesCollection6;};m.prototype.getActiveSubCollection=function(){'use strict';return this.$TimelinePlacesCollection3;};m.prototype.$TimelinePlacesCollection7=function(n){'use strict';if(!n)throw new Error("Don't provide enough information to register sub-collections.");this.$TimelinePlacesCollection8(n);};m.prototype.$TimelinePlacesCollection9=function(n){'use strict';if(!n.sub_collections_filter)throw Error("No sub-collection filter is specified.");if(n.map_instance_id==null)throw Error('No instance id of the map is specified.');this.$TimelinePlacesCollection6=n.map_instance_id;this.$TimelinePlacesCollection8({filter:n.sub_collections_filter});};m.prototype.$TimelinePlacesCollection8=function(n){'use strict';this.$TimelinePlacesCollection5=babelHelpers['extends']({},this.$TimelinePlacesCollection5,n);var o=this.$TimelinePlacesCollection5;if(!o.sub_collections||!o.sub_collections.length||!o.filter||!this.$TimelinePlacesCollection1||o.profile_id==null||!o.more_popover_menu||!o.more_menu)return;for(var p=0;p<o.sub_collections.length;p++){var q=null,r=o.sub_collections[p].city_id;if(r&&o.filter[r])q=c('TimelinePlacesSubCollection').build(this.$TimelinePlacesCollection4.length,this,o.sub_collections[p],this.$TimelinePlacesCollection1,o.profile_id,o.filter[r],r);if(q)this.$TimelinePlacesCollection4.push(q);}if(this.$TimelinePlacesCollection4.length){this.$TimelinePlacesCollection10(this.$TimelinePlacesCollection4,o.more_popover_menu,o.more_menu);setTimeout(function(){this.setActiveSubCollection(this.$TimelinePlacesCollection4[0]);}.bind(this),2000);}};m.prototype.$TimelinePlacesCollection10=function(n,o,p){'use strict';var q=c('DOMQuery').find(this.getParent().getNode(),"._33hy");if(!q)return;var r=c('DOM').create('div',{className:"_33hy"});c('DOM').replace(q,r);this.$TimelinePlacesCollection2=r;this.$TimelinePlacesCollection11(r,n,o,p);};m.prototype.$TimelinePlacesCollection11=function(n,o,p,q){'use strict';var r=0;for(var s=0;s<o.length;s++)if(o[s].getSubTabNode()){c('DOM').appendContent(n,o[s].getSubTabNode());r+=c('DOMDimensions').getElementDimensions(o[s].getSubTabNode()).width;}c('DOM').appendContent(n,p);r+=c('DOMDimensions').getElementDimensions(p).width;if(r<=l){c('CSS').hide(p);}else{var t=o.length-1;while(r>l){if(t<0)return;r-=c('DOMDimensions').getElementDimensions(o[t].getSubTabNode()).width;c('DOM').remove(o[t].getSubTabNode());var u=new (c('MenuItem'))({markup:o[t].getSubTabNode()});if(q.getItemAt(0)){q.addItemBefore(u,q.getItemAt(0));}else q.addItem(u);t--;}}};m.registerSubCollections=function(n){'use strict';this.checkCollectionID(n.collection_id);c('ProfileOverviewSection').callWithSection(n.collection_id,function(o){if(o)o.$TimelinePlacesCollection7(n);});};m.registerSubCollectionsFilter=function(n){'use strict';this.checkCollectionID(n.collection_id);c('ProfileOverviewSection').callWithSection(n.collection_id,function(o){if(o)o.$TimelinePlacesCollection9(n);});};m.checkCollectionID=function(n){'use strict';if(n==null)throw new Error("No collection id is specified when trying to access"+" a static function in TimelinePlacesCollection.");};f.exports=m;}),null);
__d('TimelineAppSection',['csx','cx','fbt','regeneratorRuntime','AppSectionCurationState','Arbiter','CSS','DOM','DOMQuery','DOMScroll','JSLogger','MedleyPageletRequestData','PageletSet','ProfileOverviewDOMID','ProfileOverviewSection','ProfileTabUtils','Style','TidyArbiterMixin','TimelineAppCollection','TimelineAppSectionCuration','TimelineDynamicSection','TimelineMonitor','TimelinePlacesCollection','TimelineSmartInsert','TriggerablePageletLoader','ViewportBounds','classWithMixins','ge','mixin','nullthrows'],(function a(b,c,d,e,f,g,h,i,j){var k,l,m=500,n=2,o=500,p=18,q="_5bry",r="_3s-",s=c('DOM').create('div',{className:"_3s_"});function t(z,aa){return aa.map(function(ba){if(c('ProfileTabUtils').isMapTab(z))return new (c('TimelinePlacesCollection'))(ba);return new (c('TimelineAppCollection'))(ba);});}function u(){return c('DOM').create('span',{className:"_3s18"},[c('DOM').create('a',{className:"_3s19",href:'#'},j._("More")),c('DOM').create('span',{className:"_3s1a"})]);}var v=c('JSLogger').create('collections'),w={notes:295,events:345,photos:555,app_quoraapp:569,fitness:619,friends:603,app_foodspotting:621,map:621,favorites:645,app_pinterestapp:699,app_instapp:699,books:699,movies:699,tv:699,music:725};function x(z){return w[z.replace(c('ProfileOverviewDOMID').PREFIX_MEDLEY,'')];}k=babelHelpers.inherits(y,c('classWithMixins')(c('TimelineDynamicSection'),c('mixin')(c('TidyArbiterMixin'))));l=k&&k.prototype;function y(z,aa,ba,ca){'use strict';l.constructor.call(this,c('ProfileTabUtils').getIDForSectionKey(aa),z,ba);this._sk=aa;this._title=ca;}y.prototype.registerCollections=function(z,aa,ba){'use strict';this._tabObj=null;if(this.childSections){var ca=this.childSections.getHead();while(ca){ca._resetAuxContent();ca=ca.getNext();}}t(z,aa).forEach(this.appendSection,this);var da=c('nullthrows')(this.childSections.get(ba));this.setActiveCollection(da);da.setIsLoaded(true);};y.prototype.reset=function(){'use strict';l.reset.call(this);this._tabObj=null;this._data=null;};y.prototype._createNode=function(){'use strict';var z=l._createNode.call(this);z.setAttribute('aria-labelledby',c('ProfileOverviewDOMID').PREFIX_MEDLEY_HEADER+this._sk);z.setAttribute('aria-role','region');c('DOM').prependContent(z,c('DOM').create('div',{className:"_3cz"},[this._title,c('DOM').create('div',{className:"_3dc",'aria-role':'tablist'})]));this.resetMinHeight(z);return z;};y.prototype.addAuxContent=function(z){'use strict';var aa=c('DOMQuery').scry(this.getNode(),"._6ph")[0];aa&&c('DOM').appendContent(aa,z);this._activeCollection&&this._checkTabDimensions(this._activeCollection);};y.prototype.nullStateCurationContent=function(){'use strict';if(!this._nullStateContent)return;var z=c('DOMQuery').find(this.getNode(),"._1_cb");c('DOM').replace(z.firstChild,this._nullStateContent);};y.prototype.addCurationContent=function(z,aa,ba,ca){'use strict';ca=ca?ca:0;var da=c('DOMQuery').scry(this.getNode(),"._1_cb"),ea=ca<da.length?da[ca]:null;ea&&c('DOM').appendContent(ea,z);if(ba)this._nullStateContent=ba;this.checkCurationContent(aa);};y.prototype.createTriggerLoader=function z(aa){var ba,ca,da;return c('regeneratorRuntime').async(function ea(fa){while(1)switch(fa.prev=fa.next){case 0:'use strict';ba=function(ga){var ha=c('nullthrows')(this._parentSection);ha._lastLoadedSection=this;this.setIsLoaded(true);c('TimelineSmartInsert').enable();c('TimelineSmartInsert').run(this.getNode(),function(){ga();this.unsetMinHeight();c('TimelineMonitor').poke(ha.id);}.bind(this),'viewport');}.bind(this);ca=this._data;if(ca){fa.next=9;break;}fa.next=6;return c('regeneratorRuntime').awrap(c('MedleyPageletRequestData').get());case 6:da=fa.sent;ca=babelHelpers['extends']({sk:this._sk},da,{overview:!this.isActiveAppSection()});this._data=ca;case 9:this._triggerLoader=new (c('TriggerablePageletLoader'))({controller:this._controller,data:ca,displayCallback:ba,options:{constHeight:true},node:this.getNode()},[{node:this.getNode(),onVisibleBuffer:m,onVisibleStrict:true,type:aa?c('TriggerablePageletLoader').TRIGGER_NOW:c('TriggerablePageletLoader').TRIGGER_ONVISIBLE}]);case 10:case 'end':return fa.stop();}},null,this);};y.prototype.freeze=function(){'use strict';c('CSS').addClass(this.getNode(),"_c4e");if(c('ge')(this.nodeID)&&!this.isLoaded())this._triggerLoader&&this._triggerLoader.disableTriggers();this.freezeChildren();};y.prototype.isActiveAppSection=function(){'use strict';if(this._parentSection)return this._parentSection._sk===this._sk;return false;};y.prototype.getActiveCollection=function(){'use strict';return this._activeCollection;};y.prototype.remove=function(){'use strict';if(c('PageletSet').hasPagelet(this.id))c('PageletSet').removePagelet(this.id);c('DOM').remove(this.getNode());if(this._parentSection)this._parentSection.removeChildSection(this.id);};y.prototype.setActiveCollection=function(z){'use strict';var aa=this._activeCollection;if(aa===z||!z._tabNode)return;if(aa){c('Arbiter').inform('TimelineSideAds/refresh');v.log('change_collection',{previous_collection:aa.getToken(),new_collection:z.getToken()});this.hideCollection(aa);var ba=c('DOM').scry(aa._tabNode,"div._3s_"),ca=s;if(ba.length>0)ca=ba[0];c('DOM').appendContent(z._tabNode,ca.cloneNode(true));ba.forEach(c('DOM').remove);}this._activeCollection=z;this.showCollection(z);};y.prototype.hideCollection=function(z){'use strict';if(z){if(z.getRootClass())c('CSS').removeClass(this.getNode(),z.getRootClass());this.resetMinHeight();z.disableContentLoader();c('CSS').hide(z.getNode());z.auxContent&&c('CSS').hide(z.auxContent);z.curationContent&&c('CSS').hide(z.curationContent);var aa=z._tabNode;if(aa){c('CSS').removeClass(aa,r);aa.setAttribute('aria-selected','false');}}};y.prototype.showCollection=function(z){'use strict';if(z.getRootClass())c('CSS').addClass(this.getNode(),z.getRootClass());z.auxContent&&c('CSS').show(z.auxContent);this.checkCurationContent(z);c('CSS').addClass(z._tabNode,r);this._checkTabDimensions(z);y.inform('changeCollection');if(!c('ge')(z.nodeID))c('DOM').appendContent(c('DOMQuery').find(this.getNode(),"div._3i9"),z.getNode());c('CSS').show(z.getNode());z.isLoaded()&&this.unsetMinHeight();if(z._tabNode)z._tabNode.setAttribute('aria-selected','true');z.enableContentLoader();var aa=c('ProfileTabUtils').getIDForSectionKey(this._sk),ba=c('TimelineAppSectionCuration').getSectionState(aa);if(ba)c('TimelineAppSectionCuration').refreshState(ba,aa);};y.prototype.resetMinHeight=function(z){'use strict';z=z||this.getNode();var aa=x(this.id)||z.offsetHeight-n;aa>0&&this._updateScrollAfterHeight(z,aa);};y.prototype.scrollTo=function(z,aa){'use strict';var ba=c('nullthrows')(this._parentSection),ca=c('ViewportBounds').getElementPosition(this.getNode());ca.y-=z||p;aa&&ba.toggleScrollLoad(false);c('DOMScroll').scrollTo(ca,o,null,null,0,function(){ca=c('ViewportBounds').getElementPosition(this.getNode());ca.y-=z||p;c('DOMScroll').scrollTo(ca);aa&&ba.toggleScrollLoad(true);}.bind(this));};y.prototype.thaw=function(){'use strict';c('CSS').removeClass(this.getNode(),"_c4e");this._triggerLoader&&this._triggerLoader.enableTriggers();this.thawChildren();};y.prototype.unsetMinHeight=function(){'use strict';this._updateScrollAfterHeight(this.getNode(),0);};y.prototype._updateScrollAfterHeight=function(z,aa){'use strict';c('Style').set(z,'min-height',aa+'px');c('Arbiter').inform('reflow');};y.prototype.checkCurationContent=function(z){'use strict';var aa=c('DOMQuery').scry(this.getNode(),"._2zh3")[0];if(aa){c('CSS').conditionShow(aa,z.curationContent);if(z.curationContent){c('CSS').show(z.curationContent);if(z.curationContentState&&z===this._activeCollection)c('TimelineAppSectionCuration').informState(z.curationContentState,this.id,z.getToken(),z.curationContentState!=c('AppSectionCurationState').hide);}else c('TimelineAppSectionCuration').informState(c('AppSectionCurationState').hide,this.id,z.getToken(),true);}};y.prototype._getTabObj=function(){'use strict';var z=this._tabObj;if(!z){z={aux:c('DOM').find(this.getNode(),"._6ph"),items:[],nav:c('DOM').find(this.getNode(),"._1_ca"),tabs:c('DOM').find(this.getNode(),"._3dc"),width:0};c('CSS').addClass(z.tabs,"_5brz");}this._tabObj=z;return z;};y.prototype._checkTabDimensions=function(z){'use strict';var aa=this._getTabObj(),ba=aa.nav.offsetWidth-aa.aux.offsetWidth;if(ba>=aa.width){if(!aa.hidden&&ba-aa.tabs.offsetWidth>=0)return;c('CSS').removeClass(aa.tabs,q);}if(aa.hidden&&z._tabNode&&z._tabNode.parentNode===aa.overflow&&aa.dropdown){c('DOM').prependContent(aa.overflow,aa.dropdown.previousSibling);c('DOM').insertBefore(aa.dropdown,z._tabNode);}if(ba-aa.tabs.offsetWidth>=0&&!aa.hidden)return;var ca=aa.items.length;if(ca&&aa.hidden){for(var da=0;da<ca;da++)c('DOM').appendContent(aa.tabs,aa.items[da]);c('DOM').remove(aa.dropdown);}c('CSS').conditionClass(aa.tabs,q,ba-aa.tabs.offsetWidth<0);aa.width=ba;aa.hidden=0;if(ba-aa.tabs.offsetWidth>=0)return;if(!aa.dropdown){aa.dropdown=u();aa.overflow=c('DOM').find(aa.dropdown,"._3s1a");aa.items=c('DOM').scry(this.getNode(),"._3c_");ca=aa.items.length;}c('DOM').appendContent(aa.tabs,aa.dropdown);var ea=0,fa=0;for(var ga=ca-1;ga>0&&ea<=0;ga--)if(aa.items[ga]!==z._tabNode){c('DOM').prependContent(aa.overflow,aa.items[ga]);ea=ba-aa.tabs.offsetWidth;fa++;}aa.hidden=fa;};y.createFromArray=function(z){'use strict';return z.map(function(aa){return new y(aa.controller,aa.sk,aa.label,aa.title);});};y.registerCollections=function(z,aa,ba){'use strict';c('ProfileOverviewSection').callWithSection(c('ProfileTabUtils').getIDForSectionKey(z),function(ca){ca.registerCollections(z,aa,ba);});};y.removeEmptyAppSection=function(z){'use strict';c('ProfileOverviewSection').callWithSection(c('ProfileTabUtils').getIDForSectionKey(z),function(aa){aa.remove();});};Object.assign(y,c('TidyArbiterMixin'));f.exports=y;}),null);
__d('TimelinePlacesSection',['TimelineAppSection','TimelinePlacesCollection'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('TimelineAppSection'));i=h&&h.prototype;function j(k,l,m,n){'use strict';i.constructor.call(this,k,l,m,n);}j.prototype.hideCollection=function(k){'use strict';i.hideCollection.call(this,k);if(k instanceof c('TimelinePlacesCollection'))k.hide();};j.prototype.showCollection=function(k){'use strict';i.showCollection.call(this,k);if(k instanceof c('TimelinePlacesCollection'))k.show();};f.exports=j;}),null);
__d('TimelineMedley',['csx','cx','regeneratorRuntime','Arbiter','CSS','DOM','DOMQuery','MedleyPageletRequestData','PageTransitions','ProfileOverviewDOMID','ProfileOverviewSection','ProfileTabUtils','ScriptPath','TimelineAppSection','TimelineMonitor','TimelinePlacesSection','TimelineURI','TriggerablePageletLoader','URI','ViewportBounds','$','ge','getElementPosition','nullthrows'],(function a(b,c,d,e,f,g,h,i){var j,k,l=6,m='/profile_book.php',n=2,o=false;function p(r){return r.map(function(s){var t=s.controller,u=s.sk,v=s.label,w=s.title;if(c('ProfileTabUtils').isMapTab(u))return new (c('TimelinePlacesSection'))(t,u,v,w);return new (c('TimelineAppSection'))(t,u,v,w);});}j=babelHelpers.inherits(q,c('ProfileOverviewSection'));k=j&&j.prototype;function q(r,s,t){'use strict';k.constructor.call(this,c('ProfileOverviewDOMID').MEDLEY_ROOT);this._transitionHandler=function(w){var x=this._transitionHandlerImpl(w);if(!x)this.reset();return x;}.bind(this);this._sectionBreaker=t.breaker;p(r).forEach(this.appendSection,this);c('TimelineMonitor').monitorSection(this);var u=c('nullthrows')(this.childSections.get(c('ProfileTabUtils').getIDForSectionKey(s)));this._lastLoadedSection=u.setIsLoaded(true);c('ProfileOverviewSection').setActiveSectionID(this._lastLoadedSection.id);if(o&&this.isOverviewProfileTab())this.addSectionPlaceholders();var v=c('URI').getNextURI();this._vanity=c('TimelineURI').getVanityFromURI(v);this._sk=c('TimelineURI').getTabKeyFromURI(v);c('PageTransitions').registerHandler(this._transitionHandler,l);this._monitorListener=c('Arbiter').subscribe(c('TimelineMonitor').SECTION_CHANGE,function(w,x){if(x.section instanceof c('TimelineAppSection'))this._sectionChangeHandler(x.section);}.bind(this));}q.prototype.reset=function(){'use strict';k.reset.call(this);c('MedleyPageletRequestData').reset();c('PageTransitions').removeHandler(this._transitionHandler,l);c('ProfileOverviewSection').resetGlobalState();if(this._monitorListener)this._monitorListener.unsubscribe();o=false;};q.prototype.addSectionTeasers=function(){'use strict';if(!this.isOverviewProfileTab()){c('CSS').removeClass(this.getNode(),"_c4f");this.thawChildren();this.addSectionPlaceholders();this.addSectionBreak();}};q.prototype.addUpcomingSectionPlaceholders=function(r,s){'use strict';s=s||n;while(r=r.getNext())if(!this.addSectionPlaceholder(r,r.getPrev())&&--s<=0)break;};q.prototype.addSectionPlaceholder=function(r,s,t){'use strict';if(!r.isLoaded()&&c('ge')(r.nodeID))return false;if(!c('ge')(r.nodeID)){c('DOM').insertAfter(s.getNode(),r.getNode());r.createTriggerLoader(t);return false;}return true;};q.prototype.addSectionBreak=function(){'use strict';var r=this.childSections.getHead();if(this._lastLoadedSection.getNext()&&r){c('DOM').insertAfter(r.getNode(),this._sectionBreaker);}else c('DOM').remove(this._sectionBreaker);};q.prototype.removeChildSection=function(r){'use strict';this.childSections.remove(r);if(this.childSections.getCount()==1)c('DOM').remove(this._sectionBreaker);};q.prototype.addSectionPlaceholders=function(){'use strict';this.addUpcomingSectionPlaceholders(this._lastLoadedSection);};q.prototype.getNode=function(){'use strict';return c('$')(this.id);};q.prototype.isOverviewProfileTab=function(){'use strict';return c('ProfileTabUtils').isOverviewTab(this._sk);};q.prototype.toggleScrollLoad=function(r){'use strict';o=r;if(r){this.thawChildren();this.addSectionPlaceholders();}else this.freezeChildren();};q.prototype._sectionChangeHandler=function(r){'use strict';c('ScriptPath').set(m+':'+r._sk);};q.prototype._transitionHandlerImpl=function(r){var s,t=this;'use strict';if(c('TimelineURI').getVanityFromURI(r)!==this._vanity)return false;var u=c('TimelineURI').getTabKeyFromURI(r);if(c('ProfileTabUtils').isTimelineTab(u))return false;if(c('ProfileTabUtils').isOverviewTab(u)){return false;}else{var s=function(){var v=r.getQueryData();if(!v.next_cursor)return {v:false};var w=t.childSections.getHead();while(w){if(w._sk===u){if(!w._activeCollection||!c('DOMQuery').scry(w._activeCollection.getNode(),"._3t3")[0])return {v:false};c('Arbiter').inform('save_facebar_query',true);setTimeout(function(){(function x(){return c('regeneratorRuntime').async(function y(z){while(1)switch(z.prev=z.next){case 0:if(!w){z.next=3;break;}z.next=3;return c('regeneratorRuntime').awrap(this._transitionToSection(w,v));case 3:case 'end':return z.stop();}},null,this);}).bind(this)().done();}.bind(t),0);return {v:true};}w=w.getNext();}}();if(typeof s==="object")return s.v;}return false;};q.prototype._transitionToSection=function r(s,t){var u,v,w,x;return c('regeneratorRuntime').async(function y(z){while(1)switch(z.prev=z.next){case 0:'use strict';u=c('getElementPosition')(s.getNode()).y-c('ViewportBounds').getTop();c('DOM').scry(s.getNode(),"._51k9").forEach(function(aa){c('CSS').removeClass(aa,"_51k9");});this._sk=s._sk;v=c('nullthrows')(s._activeCollection);c('ProfileOverviewSection').setActiveSectionID(s.id);s.thaw();c('CSS').addClass(this.getNode(),"_c4f");this.freezeChildren();w=c('DOMQuery').find(v.getNode(),"._3t3");z.next=12;return c('regeneratorRuntime').awrap(v.addContentLoader(w,t.next_cursor));case 12:if(v._contentLoader)v._contentLoader.load({node:w,type:c('TriggerablePageletLoader').TRIGGER_NOW});x=this.childSections.getHead();while(x&&x.id!==s.id){x.remove();x=this.childSections.getHead();}c('ProfileOverviewSection').inform('Medley/transitionToSection',s.id);s.scrollTo(u<0?u:0);if(this._sk)c('ScriptPath').set(m+':'+this._sk);c('PageTransitions').transitionComplete();case 19:case 'end':return z.stop();}},null,this);};q.scrollToSection=function(r,s,t){'use strict';c('ProfileOverviewSection').callWithSection(r,function(u){u.scrollTo(s,t);});};q.toggleScrollLoad=function(r){'use strict';o=r;c('ProfileOverviewSection').callWithSection(c('ProfileOverviewDOMID').MEDLEY_ROOT,function(s){s.toggleScrollLoad(r);});};f.exports=q;}),null);
__d('PhotoCreateButtonsVisibility',['csx','Arbiter','CSS','DOMQuery','Event','Parent','$'],(function a(b,c,d,e,f,g,h){function i(k){var l=c('Parent').bySelector(k,"._3cz");return c('DOMQuery').find(l,"._69l");}var j={addHideClickListener:function k(l){c('Event').listen(l,'click',function(){c('CSS').hide(i(l));});},addShowClickListener:function k(l){c('Event').listen(l,'click',function(){c('CSS').show(i(l));});},hideButtons:function k(l){var m=c('$')('pagelet_timeline_medley_photos');c('CSS').hide(c('DOMQuery').find(m,"._69l"));},showButtonOnTabChange:function k(l){c('Arbiter').subscribe('Medley/tab-change',function(m){c('CSS').show(l);});}};f.exports=j;}),null);